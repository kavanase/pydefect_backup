
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Tutorial of pydefect &#8212; pydefect beta documentation</title>
    <link rel="stylesheet" href="_static/corlab.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/language_data.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="nav-item nav-item-0"><a href="index.html">pydefect beta documentation</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="tutorial-of-pydefect">
<h1>Tutorial of pydefect<a class="headerlink" href="#tutorial-of-pydefect" title="Permalink to this headline">¶</a></h1>
<hr class="docutils" />
<p>We here illustrate how to use the PyDefect code.</p>
<p><strong>Note1: Units used in PyDefect are eV and Angstrom for energy and length following the vasp convention.</strong></p>
<p><strong>Note2: Only nonmagnetic host materials are allowed for now.</strong></p>
<p>Usually, point-defect calculations in non-metallic solids are intricate as shown in the workflow below;
some tasks can be performed concurrently, while others must follow some tasks.</p>
<p><img alt="_images/flowchart.png" src="_images/flowchart.png" /></p>
<p>Here, we suppose the following directory tree.
The <code class="docutils literal notranslate"><span class="pre">&lt;project_name&gt;</span></code> is usually the name of material or that with crystal structure, e.g., rutile-TiO2.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;project_name&gt;
 │
 ├ unitcell/ ── structure_opt/
 │            ├ band/
 │            └ dos/
 │            
 ├ competing_phases/ ── &lt;competing_phase 1&gt;
 │                    ├── &lt;competing_phase 2&gt;
 │                    ....
 │  
 └ defects/ ── perfect/  
              ├─ Va_X_0/
              ├─ Va_X_1/
              ├─ Va_X_2/
             ...
</pre></div>
</div>
<p>We recommend the user to follow the same directory structure as this tutorial is assumed it.
Details of the process are examined step by step.</p>
<div class="section" id="relaxation-of-unit-cell">
<h2>1. Relaxation of unit cell<a class="headerlink" href="#relaxation-of-unit-cell" title="Permalink to this headline">¶</a></h2>
<p>Since point defect calculations are generally performed at a fully relaxed theoretical structures,
one begins with optimizing lattice constants and fractional coordinates of atomic positions in the unitcell.</p>
<p>First, we prepare the POSCAR file for the pristine bulk unitcell,
and create <code class="docutils literal notranslate"><span class="pre">unitcell/</span></code> directory and <code class="docutils literal notranslate"><span class="pre">unitcell/structure_opt/</span></code> subdirectory and move there.
In this tutorial, <code class="docutils literal notranslate"><span class="pre">/</span></code> means a directory.
PyDefect can construct the vasp input files namely INCAR, POTCAR, KPOINTS files, for various tasks and exchange-correlation (XC) functional with simple command line tools.
For instance, vasp input files or optimizing structure of unitcell using the PBEsol functional are generated by the following command.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>python $PATH_TO_PYDEFECT/pydefect/main.py vasp_oba_set -t structure_opt -x pbesol
</pre></div>
</div>
<p>where <code class="docutils literal notranslate"><span class="pre">vasp_oba_set</span></code>, or its abbreviation (<code class="docutils literal notranslate"><span class="pre">vos</span></code>) , is a sub-command option.
In PyDefect, all the sub-commands have their own abbreviated sub-commands.
When PyDefect creates vasp input files, analyze and visualize vasp output files,
the VaspObaSet library, written by Kumagai largely on the basis of <a class="reference external" href="http://pymatgen.org">pymatgen</a> mostly developed by Materials Project team, is used.</p>
<p>In such case, as shown <a class="reference external" href="https://pymatgen.org/usage.html">here</a> and <a class="reference external" href="https://pymatgen.org/_modules/pymatgen/io/vasp/inputs.html">here</a>, we need to set the PMG_DEFAULT_FUNCTIONAL and PMG_VASP_PSP_DIR at the .pmgrc.yaml file, e.g.,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PMG_DEFAULT_FUNCTIONAL</span><span class="p">:</span> <span class="n">PBE_54</span>
<span class="n">PMG_MAPI_KEY</span><span class="p">:</span> <span class="n">xxxxxxxxxxxxxxxx</span>
<span class="n">PMG_VASP_PSP_DIR</span><span class="p">:</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">kuma</span><span class="o">/</span><span class="n">potcars</span><span class="o">/</span>
</pre></div>
</div>
<p>PMG_MAPI_KEY needs to be set as well for querying POSCARs for competing materials structures as shown later.
In VaspObaSet, we provide the default potcar set regularly we use.
CHANGE THE PROGRAM TO ALLOW USER POTCAR AND MODIFY THIS TUTORIAL.</p>
<p>There are many options for each sub-command, so please refer the help of the sub-command, e.g., by</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="o">~/</span><span class="n">my_bin</span><span class="o">/</span><span class="n">pydefect</span><span class="o">/</span><span class="n">pydefect</span><span class="o">/</span><span class="n">main</span><span class="o">.</span><span class="n">py</span> <span class="n">vos</span> <span class="o">-</span><span class="n">h</span>
</pre></div>
</div>
<p>for details.</p>
<p>Note that the structure optimization must be generally iterated with 1.3 times larger cutoff energy until the forces and stresses converge at the first ionic step so as to avoid the error caused by the Pulay Stress.
See <a class="reference external" href="https://cms.mpi.univie.ac.at/vasp/vasp/Volume_vs_energy_volume_relaxations_Pulay_Stress.html">vasp manual</a> or <a class="reference external" href="https://cms.mpi.univie.ac.at/vasp/vasp/Volume_vs_energy_volume_relaxations_Pulay_Stress.html">wikipedia</a> for details.
Such iteration of vasp calculations is not supported by PyDefect, but one can easily write the simple scripts to do so.</p>
</div>
<div class="section" id="calculation-of-band-dos-and-dielectric-tensor">
<h2>2. Calculation of band, DOS, and dielectric tensor<a class="headerlink" href="#calculation-of-band-dos-and-dielectric-tensor" title="Permalink to this headline">¶</a></h2>
<p>We then calculate the band structure (BS), density of states (DOS), and dielectric constant.
In the defect calculations, the BS and DOS are used for determining the valence band maximum (VBM) and conduction band minimum (CBM),
while the dielectric constant, a sum of electronic and ionic dielectric tensors, is needed for correcting the defect formation energies and defect eigenvalues.</p>
<p>First, create <code class="docutils literal notranslate"><span class="pre">band/</span></code>, <code class="docutils literal notranslate"><span class="pre">dos/</span></code> and <code class="docutils literal notranslate"><span class="pre">dielectric/</span></code> in <code class="docutils literal notranslate"><span class="pre">unitcell/</span></code> and copy POSCAR from <code class="docutils literal notranslate"><span class="pre">unitcell/structure_opt</span></code> and type the following command in each directory,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="o">~/</span><span class="n">my_bin</span><span class="o">/</span><span class="n">pydefect</span><span class="o">/</span><span class="n">pydefect</span><span class="o">/</span><span class="n">main</span><span class="o">.</span><span class="n">py</span> <span class="n">vos</span> <span class="o">-</span><span class="n">t</span> <span class="n">band</span> <span class="o">-</span><span class="n">x</span> <span class="n">pbesol</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="o">~/</span><span class="n">my_bin</span><span class="o">/</span><span class="n">pydefect</span><span class="o">/</span><span class="n">pydefect</span><span class="o">/</span><span class="n">main</span><span class="o">.</span><span class="n">py</span> <span class="n">vos</span> <span class="o">-</span><span class="n">t</span> <span class="n">dos</span> <span class="o">-</span><span class="n">x</span> <span class="n">pbesol</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="o">~/</span><span class="n">my_bin</span><span class="o">/</span><span class="n">pydefect</span><span class="o">/</span><span class="n">pydefect</span><span class="o">/</span><span class="n">main</span><span class="o">.</span><span class="n">py</span> <span class="n">vos</span> <span class="o">-</span><span class="n">t</span> <span class="n">dielectric</span> <span class="o">-</span><span class="n">x</span> <span class="n">pbesol</span>
</pre></div>
</div>
<p>and run the vasp calculations.
Here, the band path is determined based upon the <a class="reference external" href="https://www.materialscloud.org/work/tools/seekpath">seekpath code</a>,
so if one uses the plot for publication or presentation, please cite the following paper.</p>
<ul class="simple">
<li><p><a class="reference external" href="https://www.sciencedirect.com/science/article/pii/S0927025616305110?via%3Dihub">Y. Hinuma, G. Pizzi, Y. Kumagai, F. Oba, I. Tanaka, Band structure diagram paths based on crystallography, Comp. Mat. Sci. 128, 140 (2017).</a>
DOI: 10.1016/j.commatsci.2016.10.015 (the “HPKOT” paper; arXiv version: arXiv:1602.06402).</p></li>
</ul>
<p>For drawing BS and DOS, PyDefect also provides their plotters based on VaspObaSet with <code class="docutils literal notranslate"><span class="pre">plot_band</span></code> (=<code class="docutils literal notranslate"><span class="pre">pb</span></code>) and <code class="docutils literal notranslate"><span class="pre">plot_dos</span></code> (=<code class="docutils literal notranslate"><span class="pre">pd</span></code>) sub-commands.
Type the following commands in <code class="docutils literal notranslate"><span class="pre">band/</span></code> and  <code class="docutils literal notranslate"><span class="pre">dos/</span></code>, respectively.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="o">~/</span><span class="n">my_bin</span><span class="o">/</span><span class="n">phos_pbesol</span><span class="o">/</span><span class="n">obadb</span><span class="o">/</span><span class="n">obadb</span><span class="o">/</span><span class="n">analyzer</span><span class="o">/</span><span class="n">main</span><span class="o">.</span><span class="n">py</span> <span class="n">pb</span> <span class="o">-</span><span class="n">v</span> <span class="n">vasprun</span><span class="o">.</span><span class="n">xml</span> <span class="o">-</span><span class="n">k</span> <span class="n">KPOINTS</span> <span class="o">-</span><span class="n">f</span> <span class="n">band</span><span class="o">.</span><span class="n">pdf</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="o">~/</span><span class="n">my_bin</span><span class="o">/</span><span class="n">phos_pbesol</span><span class="o">/</span><span class="n">obadb</span><span class="o">/</span><span class="n">obadb</span><span class="o">/</span><span class="n">analyzer</span><span class="o">/</span><span class="n">main</span><span class="o">.</span><span class="n">py</span> <span class="n">pd</span> <span class="o">-</span><span class="n">v</span> <span class="n">vasprun</span><span class="o">.</span><span class="n">xml</span> <span class="o">-</span><span class="n">f</span> <span class="n">dos</span><span class="o">.</span><span class="n">pdf</span>
</pre></div>
</div>
</div>
<div class="section" id="gathering-unitcell-information-related-to-point-defect-calculations">
<h2>3. Gathering unitcell information related to point-defect calculations<a class="headerlink" href="#gathering-unitcell-information-related-to-point-defect-calculations" title="Permalink to this headline">¶</a></h2>
<p>We next collect the bulk information relevant to point-defect calculations, namely band edges (for defect-formation energies),
electronic and ionic contributions to dielectric tensor (for corrections), unitcell volume, and unitcell DOS (both for carrier and defect concentrations),
using the <code class="docutils literal notranslate"><span class="pre">unitcell_results</span></code> (=<code class="docutils literal notranslate"><span class="pre">ur</span></code>) sub-command.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="o">~/</span><span class="n">my_bin</span><span class="o">/</span><span class="n">pydefect</span><span class="o">/</span><span class="n">pydefect</span><span class="o">/</span><span class="n">main</span><span class="o">.</span><span class="n">py</span> <span class="n">ur</span> <span class="o">--</span><span class="n">static_diele_dir</span> <span class="n">dielectric</span> <span class="o">--</span><span class="n">ionic_diele_dir</span> <span class="n">dielectric</span> <span class="o">--</span><span class="n">band_edge_dir</span> <span class="n">band</span> <span class="o">--</span><span class="n">volume_dir</span> <span class="n">dielectric</span> <span class="o">--</span><span class="n">total_dos_dir</span> <span class="n">dos</span> <span class="o">--</span><span class="n">json_file</span> <span class="n">unitcell</span><span class="o">.</span><span class="n">json</span> <span class="o">-</span><span class="n">o</span> <span class="n">OUTCAR</span><span class="o">-</span><span class="n">finish</span> <span class="o">-</span><span class="n">p</span> <span class="n">POSCAR</span><span class="o">-</span><span class="n">finish</span> <span class="o">-</span><span class="n">v</span> <span class="n">vasprun</span><span class="o">.</span><span class="n">xml</span>
</pre></div>
</div>
<p>In this command, we suppose the situation where the OUTCAR and CONTCAR files are renamed to OUTCAR-finish and POSCAR-finish, respectively,
and specify these files using <code class="docutils literal notranslate"><span class="pre">-o</span></code> and <code class="docutils literal notranslate"><span class="pre">-p</span></code> options, respectively.
With this command, <code class="docutils literal notranslate"><span class="pre">unitcell.json</span></code> is generated, which will be used for the analysis later.
Generally, json files are less readable for human beings, so we usually implement <code class="docutils literal notranslate"><span class="pre">print</span></code> option to show readable information from json files, like</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="o">~/</span><span class="n">my_bin</span><span class="o">/</span><span class="n">pydefect</span><span class="o">/</span><span class="n">pydefect</span><span class="o">/</span><span class="n">main</span><span class="o">.</span><span class="n">py</span> <span class="n">ur</span> <span class="o">--</span><span class="nb">print</span>
</pre></div>
</div>
<p>Here, we show an example of unitcell info.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">vbm</span> <span class="p">(</span><span class="n">eV</span><span class="p">):</span> <span class="mf">3.4103</span>
<span class="n">cbm</span> <span class="p">(</span><span class="n">eV</span><span class="p">):</span> <span class="mf">4.4278</span>
<span class="n">static</span> <span class="n">dielectric</span> <span class="n">tensor</span><span class="p">:</span>
<span class="p">[[</span> <span class="mf">4.680097</span> <span class="o">-</span><span class="mf">0.</span>       <span class="o">-</span><span class="mf">0.</span>      <span class="p">]</span>
 <span class="p">[</span><span class="o">-</span><span class="mf">0.</span>        <span class="mf">4.680097</span>  <span class="mf">0.</span>      <span class="p">]</span>
 <span class="p">[</span> <span class="mf">0.</span>       <span class="o">-</span><span class="mf">0.</span>        <span class="mf">4.680097</span><span class="p">]]</span>
<span class="n">ionic</span> <span class="n">dielectric</span> <span class="n">tensor</span><span class="p">:</span>
<span class="p">[[</span><span class="mf">14.953044</span> <span class="o">-</span><span class="mf">0.</span>        <span class="mf">0.</span>      <span class="p">]</span>
 <span class="p">[</span><span class="o">-</span><span class="mf">0.</span>       <span class="mf">14.953065</span> <span class="o">-</span><span class="mf">0.</span>      <span class="p">]</span>
 <span class="p">[</span> <span class="mf">0.</span>       <span class="o">-</span><span class="mf">0.</span>       <span class="mf">14.953038</span><span class="p">]]</span>
<span class="n">total</span> <span class="n">dielectric</span> <span class="n">tensor</span><span class="p">:</span>
<span class="p">[[</span><span class="mf">19.633141000000002</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">19.633162</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">19.633135</span><span class="p">]]</span>
<span class="n">volume</span> <span class="p">(</span><span class="n">A</span><span class="o">^</span><span class="mi">3</span><span class="p">):</span> <span class="mf">68.98647886527607</span>
<span class="n">Total</span> <span class="n">DOS</span><span class="p">:</span> <span class="n">Exists</span>
</pre></div>
</div>
<p>Since information of total dos is so long, we show only whether it exists.</p>
</div>
<div class="section" id="calculation-of-competing-phases">
<h2>4. Calculation of competing phases<a class="headerlink" href="#calculation-of-competing-phases" title="Permalink to this headline">¶</a></h2>
<p>When a defect is introduced, atoms are exchanged with the hypothetical atomic reservoirs within the thermodynamics framework.
In order to calculate free energy of defect formation that is approximated with the defect formation energy in most cases,
we need to set the chemical potentials of exchanged atoms accompanied with creating defects.
Usually, we consider the chemical potentials at the condition where competing phases coexist with the host material,
and for this purpose, need to calculate the chemical potential diagram.</p>
<p>First, we create directories in <code class="docutils literal notranslate"><span class="pre">competing_phases/</span></code> for competing phases including VASP input sets in each directory.
Using the chempotdiag library developed and managed by Akira Takahashi, we can retrieve POSCARs of the stable or slightly unstable competing phases from <a class="reference external" href="https://materialsproject.org">the Materials Project (MP)</a>.
For this purpose, one needs <a class="reference external" href="https://materialsproject.org/open">the API keys</a> of the MP as mentioned above.
Here, we show an example
We obtain the competing materials with BaSnO of which energy above hull is less than 0.5 meV/atom are collected with</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="o">~/</span><span class="n">my_bin</span><span class="o">/</span><span class="n">phos_pbesol</span><span class="o">/</span><span class="n">obadb</span><span class="o">/</span><span class="n">obadb</span><span class="o">/</span><span class="n">analyzer</span><span class="o">/</span><span class="n">chempotdiag</span><span class="o">/</span><span class="n">main</span><span class="o">.</span><span class="n">py</span> <span class="n">cpd</span> <span class="o">-</span><span class="n">m</span> <span class="o">-</span><span class="n">el</span> <span class="n">Ba</span> <span class="n">Sn</span> <span class="n">O</span> <span class="o">-</span><span class="n">ch</span> <span class="mf">0.05</span>
</pre></div>
</div>
<p>Particular molecules, namely O2, N2, F2, H2O, N2, NH3, NO2, P2, and P4, are exceptions and their POSCARs are not retrieved from MP as they have been calculated as solids in MP, but created by chempotdiag.</p>
<p>The bulk structure, namely BaSnO3 in this example, has already been calculated, so we do not have to iterate the same calculations.
Therefore, we simply remove <code class="docutils literal notranslate"><span class="pre">Ba1Sn1O3_mp-3163</span></code> and make a symbolic link by <code class="docutils literal notranslate"><span class="pre">ln</span> <span class="pre">-s</span> <span class="pre">../unitcell/structure_opt</span> <span class="pre">BaSnO3</span></code>.</p>
<p>We then generate <code class="docutils literal notranslate"><span class="pre">INCAR</span></code>, <code class="docutils literal notranslate"><span class="pre">POTCAR</span></code>, <code class="docutils literal notranslate"><span class="pre">KPOINTS</span></code> files for other competing solids or molecules.
In order to compare the total energies, we need to use the same cutoff energy, <code class="docutils literal notranslate"><span class="pre">ENCUT</span></code>, increased to 1.3 times of max <code class="docutils literal notranslate"><span class="pre">ENMAX</span></code> between the constituent POTCARs.
In case of BaSnO3, <code class="docutils literal notranslate"><span class="pre">ENMAX</span></code> of Ba, Sn, and O are 187.181, 103.236, 400.0, so we need to set <code class="docutils literal notranslate"><span class="pre">ENCUT</span> <span class="pre">=</span> <span class="pre">520</span></code>,
This is possible with <code class="docutils literal notranslate"><span class="pre">-is</span></code> option, which means <code class="docutils literal notranslate"><span class="pre">INCAR</span> <span class="pre">settings</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="o">~/</span><span class="n">my_bin</span><span class="o">/</span><span class="n">pydefect</span><span class="o">/</span><span class="n">pydefect</span><span class="o">/</span><span class="n">main</span><span class="o">.</span><span class="n">py</span> <span class="n">vos</span> <span class="o">-</span><span class="n">t</span> <span class="n">structure_opt</span> <span class="o">-</span><span class="n">x</span> <span class="n">pbesol</span> <span class="o">-</span><span class="ow">is</span> <span class="n">ENCUT</span> <span class="mi">520</span> <span class="o">--</span><span class="n">dirs</span> <span class="o">*</span><span class="n">_</span><span class="o">*/</span>
</pre></div>
</div>
<p>Note, if competing phases are gases, we need to change the <code class="docutils literal notranslate"><span class="pre">ISIF</span></code> to 2 so as not to relax the lattice constants, and <code class="docutils literal notranslate"><span class="pre">KPOINTS</span></code> requires only the Gamma point sampling.
In such case, type as follows,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="o">~/</span><span class="n">my_bin</span><span class="o">/</span><span class="n">pydefect</span><span class="o">/</span><span class="n">pydefect</span><span class="o">/</span><span class="n">main</span><span class="o">.</span><span class="n">py</span> <span class="n">vos</span> <span class="o">-</span><span class="n">t</span> <span class="n">structure_opt</span> <span class="o">-</span><span class="n">x</span> <span class="n">pbesol</span> <span class="o">-</span><span class="ow">is</span> <span class="n">ENCUT</span> <span class="mi">520</span> <span class="n">ISIF</span> <span class="mi">2</span> <span class="o">-</span><span class="n">kw</span> <span class="n">is_cluster</span> <span class="kc">True</span> <span class="o">--</span><span class="n">dirs</span> <span class="n">O2molecule_pydefect</span>
</pre></div>
</div>
<p>where O2molecule_pydefect is a directory for the O2 molecule model.</p>
<p>After finishing the vasp calculations, we generate the chemical potential diagram with</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="o">~/</span><span class="n">my_bin</span><span class="o">/</span><span class="n">phos_pbesol</span><span class="o">/</span><span class="n">obadb</span><span class="o">/</span><span class="n">obadb</span><span class="o">/</span><span class="n">analyzer</span><span class="o">/</span><span class="n">chempotdiag</span><span class="o">/</span><span class="n">main</span><span class="o">.</span><span class="n">py</span> <span class="n">cpd</span> <span class="o">-</span><span class="n">v</span> <span class="o">*/</span> <span class="o">-</span><span class="n">p</span> <span class="n">POSCAR</span><span class="o">-</span><span class="n">finish</span> <span class="o">-</span><span class="n">o</span> <span class="n">OUTCAR</span><span class="o">-</span><span class="n">finish</span> <span class="o">-</span><span class="n">c</span> <span class="n">BaSnO3</span> <span class="o">-</span><span class="n">y</span> <span class="o">-</span><span class="n">s</span> <span class="n">cpd_BaSnO3</span><span class="o">.</span><span class="n">pdf</span>
</pre></div>
</div>
<p>Note that there are parameters for gas phases that set the partial pressure and temperature for chemical potentials (read help for more details).
With this command, we depict the Ba-Sn-O chemical potential diagram saved as <code class="docutils literal notranslate"><span class="pre">cpd_BaSnO3.pdf</span></code>
<img alt="_images/cpd_BaSnO3.png" src="_images/cpd_BaSnO3.png" /></p>
<p>and values at the vertices at the BaSnO3 region written in <code class="docutils literal notranslate"><span class="pre">vertices_BaSnO3.yaml</span></code> as shown</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">A</span><span class="p">:</span> <span class="p">{</span><span class="n">Ba</span><span class="p">:</span> <span class="o">-</span><span class="mf">6.339048510000005</span><span class="p">,</span> <span class="n">O</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.18899787319844918</span><span class="p">,</span> <span class="n">Sn</span><span class="p">:</span> <span class="o">-</span><span class="mf">5.638818995000001</span><span class="p">}</span>
<span class="n">B</span><span class="p">:</span> <span class="p">{</span><span class="n">Ba</span><span class="p">:</span> <span class="o">-</span><span class="mf">5.9688971474999875</span><span class="p">,</span> <span class="n">O</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.22601300944845448</span><span class="p">,</span> <span class="n">Sn</span><span class="p">:</span> <span class="o">-</span><span class="mf">5.897924948750013</span><span class="p">}</span>
<span class="n">C</span><span class="p">:</span> <span class="p">{</span><span class="n">Ba</span><span class="p">:</span> <span class="o">-</span><span class="mf">5.257239969999993</span><span class="p">,</span> <span class="n">O</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.5818415981984444</span><span class="p">,</span> <span class="n">Sn</span><span class="p">:</span> <span class="o">-</span><span class="mf">5.542096360000016</span><span class="p">}</span>
<span class="n">D</span><span class="p">:</span> <span class="p">{</span><span class="n">Ba</span><span class="p">:</span> <span class="o">-</span><span class="mf">2.4861917899999817</span><span class="p">,</span> <span class="n">O</span><span class="p">:</span> <span class="o">-</span><span class="mf">3.3528897781984526</span><span class="p">,</span> <span class="n">Sn</span><span class="p">:</span> <span class="mf">3.552713678800501e-15</span><span class="p">}</span>
<span class="n">E</span><span class="p">:</span> <span class="p">{</span><span class="n">Ba</span><span class="p">:</span> <span class="o">-</span><span class="mf">3.2221928749999975</span><span class="p">,</span> <span class="n">O</span><span class="p">:</span> <span class="o">-</span><span class="mf">3.1075560831984568</span><span class="p">,</span> <span class="n">Sn</span><span class="p">:</span> <span class="mf">3.552713678800501e-15</span><span class="p">}</span>
<span class="n">F</span><span class="p">:</span> <span class="p">{</span><span class="n">Ba</span><span class="p">:</span> <span class="o">-</span><span class="mf">3.6187877250000113</span><span class="p">,</span> <span class="n">O</span><span class="p">:</span> <span class="o">-</span><span class="mf">2.9092586581984463</span><span class="p">,</span> <span class="n">Sn</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.19829742500001046</span><span class="p">}</span>
<span class="n">compound</span><span class="p">:</span> <span class="n">BaSnO3</span>
<span class="n">pressure</span><span class="p">:</span> <span class="n">null</span>
<span class="n">standard_energy</span><span class="p">:</span> <span class="p">{</span><span class="n">Ba</span><span class="p">:</span> <span class="o">-</span><span class="mf">2.141765</span><span class="p">,</span> <span class="n">O</span><span class="p">:</span> <span class="o">-</span><span class="mf">4.872655801801549</span><span class="p">,</span> <span class="n">Sn</span><span class="p">:</span> <span class="o">-</span><span class="mf">4.1937075</span><span class="p">}</span>
<span class="n">temperature</span><span class="p">:</span> <span class="mi">0</span>
</pre></div>
</div>
<p>Here, <code class="docutils literal notranslate"><span class="pre">standard_energy</span></code> are the energies of the most stable simple substances or simple gas phases,
and A–F show the relative chemical potentials at the vertices shown in <code class="docutils literal notranslate"><span class="pre">cpd_BaSnO3.pdf</span></code>.</p>
</div>
<div class="section" id="select-of-a-supercell">
<h2>5. Select of a supercell<a class="headerlink" href="#select-of-a-supercell" title="Permalink to this headline">¶</a></h2>
<p>So far, we have finished the calculations of the unit cell and competing phases, and are eventually ready for point defect calculations.
Let’s create <code class="docutils literal notranslate"><span class="pre">defect/</span></code> directory and copy unitcell <code class="docutils literal notranslate"><span class="pre">POSCAR</span></code> file from e.g. <code class="docutils literal notranslate"><span class="pre">unitcell/dos/</span></code> to <code class="docutils literal notranslate"><span class="pre">defect/</span></code></p>
<p>Firstly, we need to determine the shape and size of the supercell.
PyDefect recommends a nearly isotropic supercell composed of moderate number of atoms.
For this purpose, use the <code class="docutils literal notranslate"><span class="pre">recommend_supercell</span></code> (=<code class="docutils literal notranslate"><span class="pre">rs</span></code>) sub-command,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="o">~/</span><span class="n">my_bin</span><span class="o">/</span><span class="n">pydefect</span><span class="o">/</span><span class="n">pydefect</span><span class="o">/</span><span class="n">main</span><span class="o">.</span><span class="n">py</span> <span class="n">rs</span>
</pre></div>
</div>
<p>Then, <code class="docutils literal notranslate"><span class="pre">UPOSCAR</span></code> and <code class="docutils literal notranslate"><span class="pre">SPOSCAR</span></code> that are the POSCARs for the unitcell and supercell, respectively, are generated.</p>
</div>
<div class="section" id="construction-of-defect-initial-setting">
<h2>6. Construction of defect initial setting<a class="headerlink" href="#construction-of-defect-initial-setting" title="Permalink to this headline">¶</a></h2>
<p>We then create the initial setting file for point defects with the following command.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="o">~/</span><span class="n">my_bin</span><span class="o">/</span><span class="n">pydefect</span><span class="o">/</span><span class="n">pydefect</span><span class="o">/</span><span class="n">main</span><span class="o">.</span><span class="n">py</span> <span class="ow">is</span>
</pre></div>
</div>
<p>With this command, we can build the <code class="docutils literal notranslate"><span class="pre">defect.in</span></code> file, which contains the full information on what kind of defects are to be generated automatically.
At the same time, <code class="docutils literal notranslate"><span class="pre">DPOSCAR</span></code>, POSCAR used for the defect calculations, is created.
If one follows this tutorial, DPOSCAR file is the same as SPOSCAR, while if one uses their own supercell POSCAR, the sequence of elements could be changed.</p>
<p>An example of <code class="docutils literal notranslate"><span class="pre">defect.in</span></code> is as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>  <span class="n">Space</span> <span class="n">group</span><span class="p">:</span> <span class="n">Pm</span><span class="o">-</span><span class="mi">3</span><span class="n">m</span>

<span class="n">Transformation</span> <span class="n">matrix</span><span class="p">:</span>  <span class="mi">3</span>  <span class="mi">3</span>  <span class="mi">3</span>
<span class="n">Cell</span> <span class="n">multiplicity</span><span class="p">:</span> <span class="mi">27</span>

   <span class="n">Irreducible</span> <span class="n">element</span><span class="p">:</span> <span class="n">Ba1</span>
        <span class="n">Wyckoff</span> <span class="n">letter</span><span class="p">:</span> <span class="n">a</span>
         <span class="n">Site</span> <span class="n">symmetry</span><span class="p">:</span> <span class="n">m</span><span class="o">-</span><span class="mi">3</span><span class="n">m</span>
          <span class="n">Coordination</span><span class="p">:</span> <span class="n">O2</span><span class="o">-</span><span class="p">:</span> <span class="mf">2.9</span> <span class="mf">2.9</span> <span class="mf">2.9</span> <span class="mf">2.9</span> <span class="mf">2.9</span> <span class="mf">2.9</span> <span class="mf">2.9</span> <span class="mf">2.9</span> <span class="mf">2.9</span> <span class="mf">2.9</span> <span class="mf">2.9</span> <span class="mf">2.9</span> 
      <span class="n">Equivalent</span> <span class="n">atoms</span><span class="p">:</span> <span class="mf">1.</span><span class="o">.</span><span class="mi">27</span>
<span class="n">Fractional</span> <span class="n">coordinates</span><span class="p">:</span> <span class="mf">0.1666670</span>  <span class="mf">0.1666670</span>  <span class="mf">0.1666670</span>
     <span class="n">Electronegativity</span><span class="p">:</span> <span class="mf">0.89</span>
       <span class="n">Oxidation</span> <span class="n">state</span><span class="p">:</span> <span class="mi">2</span>

   <span class="n">Irreducible</span> <span class="n">element</span><span class="p">:</span> <span class="n">Sn1</span>
        <span class="n">Wyckoff</span> <span class="n">letter</span><span class="p">:</span> <span class="n">b</span>
         <span class="n">Site</span> <span class="n">symmetry</span><span class="p">:</span> <span class="n">m</span><span class="o">-</span><span class="mi">3</span><span class="n">m</span>
          <span class="n">Coordination</span><span class="p">:</span> <span class="n">O2</span><span class="o">-</span><span class="p">:</span> <span class="mf">2.05</span> <span class="mf">2.05</span> <span class="mf">2.05</span> <span class="mf">2.05</span> <span class="mf">2.05</span> <span class="mf">2.05</span> 
      <span class="n">Equivalent</span> <span class="n">atoms</span><span class="p">:</span> <span class="mf">28.</span><span class="o">.</span><span class="mi">54</span>
<span class="n">Fractional</span> <span class="n">coordinates</span><span class="p">:</span> <span class="mf">0.0000000</span>  <span class="mf">0.0000000</span>  <span class="mf">0.0000000</span>
     <span class="n">Electronegativity</span><span class="p">:</span> <span class="mf">1.96</span>
       <span class="n">Oxidation</span> <span class="n">state</span><span class="p">:</span> <span class="mi">4</span>
       
   <span class="n">Irreducible</span> <span class="n">element</span><span class="p">:</span> <span class="n">O1</span>
        <span class="n">Wyckoff</span> <span class="n">letter</span><span class="p">:</span> <span class="n">c</span>
         <span class="n">Site</span> <span class="n">symmetry</span><span class="p">:</span> <span class="mi">4</span><span class="o">/</span><span class="n">mmm</span>
          <span class="n">Coordination</span><span class="p">:</span> <span class="n">Ba2</span><span class="o">+</span><span class="p">:</span> <span class="mf">2.9</span> <span class="mf">2.9</span> <span class="mf">2.9</span> <span class="mf">2.9</span> <span class="n">Sn4</span><span class="o">+</span><span class="p">:</span> <span class="mf">2.05</span> <span class="mf">2.05</span> <span class="n">O2</span><span class="o">-</span><span class="p">:</span> <span class="mf">2.9</span> <span class="mf">2.9</span> <span class="mf">2.9</span> <span class="mf">2.9</span> <span class="mf">2.9</span> <span class="mf">2.9</span> <span class="mf">2.9</span> <span class="mf">2.9</span> 
      <span class="n">Equivalent</span> <span class="n">atoms</span><span class="p">:</span> <span class="mf">55.</span><span class="o">.</span><span class="mi">135</span>
<span class="n">Fractional</span> <span class="n">coordinates</span><span class="p">:</span> <span class="mf">0.0000000</span>  <span class="mf">0.1666670</span>  <span class="mf">0.0000000</span>
     <span class="n">Electronegativity</span><span class="p">:</span> <span class="mf">3.44</span>
       <span class="n">Oxidation</span> <span class="n">state</span><span class="p">:</span> <span class="o">-</span><span class="mi">2</span>

<span class="n">Interstitials</span><span class="p">:</span> 
<span class="n">Antisite</span> <span class="n">defects</span><span class="p">:</span> 

<span class="n">Substituted</span> <span class="n">defects</span><span class="p">:</span> 

<span class="n">Maximum</span> <span class="n">Displacement</span><span class="p">:</span> <span class="mf">0.2</span>

<span class="n">Exceptionally</span> <span class="n">included</span><span class="p">:</span> 
<span class="n">Exceptionally</span> <span class="n">excluded</span><span class="p">:</span> 

<span class="n">Cutoff</span> <span class="n">region</span> <span class="n">of</span> <span class="n">atoms</span> <span class="n">perturbed</span><span class="p">:</span> <span class="mf">3.0</span>
<span class="n">Symprec</span><span class="p">:</span> <span class="mf">0.01</span>
<span class="n">Angle</span> <span class="n">tolerance</span><span class="p">:</span> <span class="mi">5</span>
</pre></div>
</div>
<p>If we want to add dopants a posteriori, we can type as follows.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="o">~/</span><span class="n">my_bin</span><span class="o">/</span><span class="n">pydefect</span><span class="o">/</span><span class="n">pydefect</span><span class="o">/</span><span class="n">main</span><span class="o">.</span><span class="n">py</span> <span class="ow">is</span> <span class="o">--</span><span class="n">print_dopant</span> <span class="n">Na</span>
</pre></div>
</div>
<p>This example of Na dopant shows</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>   <span class="n">Dopant</span> <span class="n">element</span><span class="p">:</span> <span class="n">Na</span>
<span class="n">Electronegativity</span><span class="p">:</span> <span class="mf">0.93</span>
  <span class="n">Oxidation</span> <span class="n">state</span><span class="p">:</span> <span class="mi">1</span>
</pre></div>
</div>
<p>By inserting this to <code class="docutils literal notranslate"><span class="pre">defect.in</span></code> and modify <code class="docutils literal notranslate"><span class="pre">Substituted</span> <span class="pre">defects</span></code> as follows</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>  <span class="n">Space</span> <span class="n">group</span><span class="p">:</span> <span class="n">Pm</span><span class="o">-</span><span class="mi">3</span><span class="n">m</span>

<span class="n">Transformation</span> <span class="n">matrix</span><span class="p">:</span>  <span class="mi">3</span>  <span class="mi">3</span>  <span class="mi">3</span>
<span class="n">Cell</span> <span class="n">multiplicity</span><span class="p">:</span> <span class="mi">27</span>

   <span class="n">Irreducible</span> <span class="n">element</span><span class="p">:</span> <span class="n">Ba1</span>
        <span class="n">Wyckoff</span> <span class="n">letter</span><span class="p">:</span> <span class="n">a</span>
         <span class="n">Site</span> <span class="n">symmetry</span><span class="p">:</span> <span class="n">m</span><span class="o">-</span><span class="mi">3</span><span class="n">m</span>
          <span class="n">Coordination</span><span class="p">:</span> <span class="n">O2</span><span class="o">-</span><span class="p">:</span> <span class="mf">2.9</span> <span class="mf">2.9</span> <span class="mf">2.9</span> <span class="mf">2.9</span> <span class="mf">2.9</span> <span class="mf">2.9</span> <span class="mf">2.9</span> <span class="mf">2.9</span> <span class="mf">2.9</span> <span class="mf">2.9</span> <span class="mf">2.9</span> <span class="mf">2.9</span> 
      <span class="n">Equivalent</span> <span class="n">atoms</span><span class="p">:</span> <span class="mf">1.</span><span class="o">.</span><span class="mi">27</span>
<span class="n">Fractional</span> <span class="n">coordinates</span><span class="p">:</span> <span class="mf">0.1666670</span>  <span class="mf">0.1666670</span>  <span class="mf">0.1666670</span>
     <span class="n">Electronegativity</span><span class="p">:</span> <span class="mf">0.89</span>
       <span class="n">Oxidation</span> <span class="n">state</span><span class="p">:</span> <span class="mi">2</span>

   <span class="n">Irreducible</span> <span class="n">element</span><span class="p">:</span> <span class="n">Sn1</span>
        <span class="n">Wyckoff</span> <span class="n">letter</span><span class="p">:</span> <span class="n">b</span>
         <span class="n">Site</span> <span class="n">symmetry</span><span class="p">:</span> <span class="n">m</span><span class="o">-</span><span class="mi">3</span><span class="n">m</span>
          <span class="n">Coordination</span><span class="p">:</span> <span class="n">O2</span><span class="o">-</span><span class="p">:</span> <span class="mf">2.05</span> <span class="mf">2.05</span> <span class="mf">2.05</span> <span class="mf">2.05</span> <span class="mf">2.05</span> <span class="mf">2.05</span> 
      <span class="n">Equivalent</span> <span class="n">atoms</span><span class="p">:</span> <span class="mf">28.</span><span class="o">.</span><span class="mi">54</span>
<span class="n">Fractional</span> <span class="n">coordinates</span><span class="p">:</span> <span class="mf">0.0000000</span>  <span class="mf">0.0000000</span>  <span class="mf">0.0000000</span>
     <span class="n">Electronegativity</span><span class="p">:</span> <span class="mf">1.96</span>
       <span class="n">Oxidation</span> <span class="n">state</span><span class="p">:</span> <span class="mi">4</span>

   <span class="n">Irreducible</span> <span class="n">element</span><span class="p">:</span> <span class="n">O1</span>
        <span class="n">Wyckoff</span> <span class="n">letter</span><span class="p">:</span> <span class="n">c</span>
         <span class="n">Site</span> <span class="n">symmetry</span><span class="p">:</span> <span class="mi">4</span><span class="o">/</span><span class="n">mmm</span>
          <span class="n">Coordination</span><span class="p">:</span> <span class="n">Ba2</span><span class="o">+</span><span class="p">:</span> <span class="mf">2.9</span> <span class="mf">2.9</span> <span class="mf">2.9</span> <span class="mf">2.9</span> <span class="n">Sn4</span><span class="o">+</span><span class="p">:</span> <span class="mf">2.05</span> <span class="mf">2.05</span> <span class="n">O2</span><span class="o">-</span><span class="p">:</span> <span class="mf">2.9</span> <span class="mf">2.9</span> <span class="mf">2.9</span> <span class="mf">2.9</span> <span class="mf">2.9</span> <span class="mf">2.9</span> <span class="mf">2.9</span> <span class="mf">2.9</span> 
      <span class="n">Equivalent</span> <span class="n">atoms</span><span class="p">:</span> <span class="mf">55.</span><span class="o">.</span><span class="mi">135</span>
<span class="n">Fractional</span> <span class="n">coordinates</span><span class="p">:</span> <span class="mf">0.0000000</span>  <span class="mf">0.1666670</span>  <span class="mf">0.0000000</span>
     <span class="n">Electronegativity</span><span class="p">:</span> <span class="mf">3.44</span>
       <span class="n">Oxidation</span> <span class="n">state</span><span class="p">:</span> <span class="o">-</span><span class="mi">2</span>

<span class="n">Interstitials</span><span class="p">:</span> 
<span class="n">Antisite</span> <span class="n">defects</span><span class="p">:</span> 

   <span class="n">Dopant</span> <span class="n">element</span><span class="p">:</span> <span class="n">Na</span>
<span class="n">Electronegativity</span><span class="p">:</span> <span class="mf">0.93</span>
  <span class="n">Oxidation</span> <span class="n">state</span><span class="p">:</span> <span class="mi">1</span>

<span class="n">Substituted</span> <span class="n">defects</span><span class="p">:</span> <span class="n">Na_Ba</span>

<span class="n">Maximum</span> <span class="n">Displacement</span><span class="p">:</span> <span class="mf">0.2</span>

<span class="n">Exceptionally</span> <span class="n">included</span><span class="p">:</span> 
<span class="n">Exceptionally</span> <span class="n">excluded</span><span class="p">:</span> 

<span class="n">Cutoff</span> <span class="n">region</span> <span class="n">of</span> <span class="n">atoms</span> <span class="n">perturbed</span><span class="p">:</span> <span class="mf">3.0</span>
<span class="n">Symprec</span><span class="p">:</span> <span class="mf">0.01</span>
<span class="n">Angle</span> <span class="n">tolerance</span><span class="p">:</span> <span class="mi">5</span>
</pre></div>
</div>
<p>There are so many tips related to <code class="docutils literal notranslate"><span class="pre">defect.in</span></code>.</p>
<ol>
<li><p>The antisites and substituted defects are determined from the difference of the electronegativity (default is 1.0.
If you want to change the difference of the electronegativity, you can use <code class="docutils literal notranslate"><span class="pre">-e</span></code> option.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="o">~/</span><span class="n">my_bin</span><span class="o">/</span><span class="n">pydefect</span><span class="o">/</span><span class="n">pydefect</span><span class="o">/</span><span class="n">main</span><span class="o">.</span><span class="n">py</span> <span class="ow">is</span> <span class="o">-</span><span class="n">e</span> <span class="mf">1.5</span>
</pre></div>
</div>
</li>
<li><p>The oxidation states determine the defect charge state.</p></li>
</ol>
</div>
<div class="section" id="decision-of-interstitial-sites">
<h2>7. Decision of interstitial sites<a class="headerlink" href="#decision-of-interstitial-sites" title="Permalink to this headline">¶</a></h2>
<p>In addition to vacancies and antisites, one may want to add the interstitials.
For this purpose, we need to determine the interstitial sites.
Most people determine the interstitial sites by seeing the host crystal structures,
while there are a couple of procedures that recommend the interstitial sites.</p>
<p>However, it is not an easy task to speculate the most likely interstitial sites
because they depend on the substituted atoms in general.
For instance, when positively charged cations with closed shells are substituted (e.g., Mg<sup>2+</sup>, Al<sup>3+</sup>),
the largest vacant space should be most likely interstitial sites.
On the other hand, in case of a proton (H<sup>+</sup>),
it tends to locate near O<sup>2-</sup> or N<sup>3-</sup> to form the strong O-H or N-H bonding.
Furthermore, a hydride ion (H<sup>-</sup>) should prefer to locate at very much different places.
Therefore, we need to be careful when determining the interstitial sites.</p>
<p>To add the interstitial site at e.g., 0.375 0.375 0.375, we type</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="o">~/</span><span class="n">my_bin</span><span class="o">/</span><span class="n">pydefect</span><span class="o">/</span><span class="n">pydefect</span><span class="o">/</span><span class="n">main</span><span class="o">.</span><span class="n">py</span> <span class="n">i</span> <span class="o">-</span><span class="n">c</span> <span class="mf">0.375</span> <span class="mf">0.375</span> <span class="mf">0.375</span>
</pre></div>
</div>
<p>interstitials.yaml is then generated, which show various information related to the interstitial sites.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">i1</span><span class="p">:</span>
  <span class="n">representative_coords</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.375</span><span class="p">,</span> <span class="mf">0.375</span><span class="p">,</span> <span class="mf">0.375</span><span class="p">]</span>
  <span class="n">wyckoff</span><span class="p">:</span> <span class="n">a</span>
  <span class="n">site_symmetry</span><span class="p">:</span> <span class="o">-</span><span class="mi">43</span><span class="n">m</span>
  <span class="n">symmetry_multiplicity</span><span class="p">:</span> <span class="mi">64</span>
  <span class="n">coordination_distances</span><span class="p">:</span>
    <span class="n">Mg</span><span class="p">:</span> <span class="p">[</span><span class="mf">1.84</span><span class="p">,</span> <span class="mf">1.84</span><span class="p">,</span> <span class="mf">1.84</span><span class="p">,</span> <span class="mf">1.84</span><span class="p">]</span>
    <span class="n">O</span><span class="p">:</span> <span class="p">[</span><span class="mf">1.84</span><span class="p">,</span> <span class="mf">1.84</span><span class="p">,</span> <span class="mf">1.84</span><span class="p">,</span> <span class="mf">1.84</span><span class="p">,</span> <span class="mf">3.52</span><span class="p">,</span> <span class="mf">3.52</span><span class="p">,</span> <span class="mf">3.52</span><span class="p">,</span> <span class="mf">3.52</span><span class="p">,</span> <span class="mf">3.52</span><span class="p">,</span> <span class="mf">3.52</span><span class="p">,</span> <span class="mf">3.52</span><span class="p">,</span> <span class="mf">3.52</span><span class="p">,</span> <span class="mf">3.52</span><span class="p">,</span>
      <span class="mf">3.52</span><span class="p">,</span> <span class="mf">3.52</span><span class="p">,</span> <span class="mf">3.52</span><span class="p">]</span>
  <span class="n">method</span><span class="p">:</span> <span class="n">manual</span>
</pre></div>
</div>
<p>If we add another site at e.g. 0.375 0.375 0.5, interstitials.yaml is updated as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">i1</span><span class="p">:</span>
  <span class="n">representative_coords</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.375</span><span class="p">,</span> <span class="mf">0.375</span><span class="p">,</span> <span class="mf">0.375</span><span class="p">]</span>
  <span class="n">wyckoff</span><span class="p">:</span> <span class="n">a</span>
  <span class="n">site_symmetry</span><span class="p">:</span> <span class="o">-</span><span class="mi">43</span><span class="n">m</span>
  <span class="n">symmetry_multiplicity</span><span class="p">:</span> <span class="mi">64</span>
  <span class="n">coordination_distances</span><span class="p">:</span>
    <span class="n">Mg</span><span class="p">:</span> <span class="p">[</span><span class="mf">1.84</span><span class="p">,</span> <span class="mf">1.84</span><span class="p">,</span> <span class="mf">1.84</span><span class="p">,</span> <span class="mf">1.84</span><span class="p">]</span>
    <span class="n">O</span><span class="p">:</span> <span class="p">[</span><span class="mf">1.84</span><span class="p">,</span> <span class="mf">1.84</span><span class="p">,</span> <span class="mf">1.84</span><span class="p">,</span> <span class="mf">1.84</span><span class="p">,</span> <span class="mf">3.52</span><span class="p">,</span> <span class="mf">3.52</span><span class="p">,</span> <span class="mf">3.52</span><span class="p">,</span> <span class="mf">3.52</span><span class="p">,</span> <span class="mf">3.52</span><span class="p">,</span> <span class="mf">3.52</span><span class="p">,</span> <span class="mf">3.52</span><span class="p">,</span> <span class="mf">3.52</span><span class="p">,</span> <span class="mf">3.52</span><span class="p">,</span>
      <span class="mf">3.52</span><span class="p">,</span> <span class="mf">3.52</span><span class="p">,</span> <span class="mf">3.52</span><span class="p">]</span>
  <span class="n">method</span><span class="p">:</span> <span class="n">manual</span>
<span class="n">i2</span><span class="p">:</span>
  <span class="n">representative_coords</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.375</span><span class="p">,</span> <span class="mf">0.375</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">]</span>
  <span class="n">wyckoff</span><span class="p">:</span> <span class="n">c</span>
  <span class="n">site_symmetry</span><span class="p">:</span> <span class="n">mmm</span>
  <span class="n">symmetry_multiplicity</span><span class="p">:</span> <span class="mi">192</span>
  <span class="n">coordination_distances</span><span class="p">:</span>
    <span class="n">Mg</span><span class="p">:</span> <span class="p">[</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mf">2.6</span><span class="p">,</span> <span class="mf">2.6</span><span class="p">,</span> <span class="mf">2.6</span><span class="p">,</span> <span class="mf">2.6</span><span class="p">]</span>
    <span class="n">O</span><span class="p">:</span> <span class="p">[</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mf">2.6</span><span class="p">,</span> <span class="mf">2.6</span><span class="p">,</span> <span class="mf">2.6</span><span class="p">,</span> <span class="mf">2.6</span><span class="p">,</span> <span class="mf">3.36</span><span class="p">,</span> <span class="mf">3.36</span><span class="p">,</span> <span class="mf">3.36</span><span class="p">,</span> <span class="mf">3.36</span><span class="p">]</span>
  <span class="n">method</span><span class="p">:</span> <span class="n">manual</span>
</pre></div>
</div>
<p>When we try to add the site that is very close to the constituent atoms or other interstitial sites,
you will get the error message as</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Inserted</span> <span class="n">position</span> <span class="ow">is</span> <span class="n">too</span> <span class="n">close</span> <span class="n">to</span> <span class="n">another</span> <span class="n">interstitial</span> <span class="n">site</span><span class="o">.</span>
<span class="n">The</span> <span class="n">distance</span> <span class="ow">is</span> <span class="mf">0.042</span> <span class="n">A</span><span class="o">.</span>
</pre></div>
</div>
<p>However, if we really want to add the site even in such cases, we can do it by adding <code class="docutils literal notranslate"><span class="pre">--force_add</span></code> option.</p>
<p>Once we generate the interstitial.yaml, we also need to modify the <code class="docutils literal notranslate"><span class="pre">Interstitials</span></code> in <code class="docutils literal notranslate"><span class="pre">defect.in</span></code> file</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Interstitials</span><span class="p">:</span> <span class="n">i1</span>
</pre></div>
</div>
<p>Or we can type subparse <code class="docutils literal notranslate"><span class="pre">is</span></code> as follows again.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="o">~/</span><span class="n">my_bin</span><span class="o">/</span><span class="n">pydefect</span><span class="o">/</span><span class="n">pydefect</span><span class="o">/</span><span class="n">main</span><span class="o">.</span><span class="n">py</span> <span class="ow">is</span> <span class="o">--</span><span class="n">interstitial_sites</span> <span class="n">i1</span> <span class="n">i2</span>
</pre></div>
</div>
</div>
<div class="section" id="creation-of-defect-calculation-directories">
<h2>8. Creation of defect calculation directories<a class="headerlink" href="#creation-of-defect-calculation-directories" title="Permalink to this headline">¶</a></h2>
<p>We next create directories for point defect supercell calculations.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="o">~/</span><span class="n">my_bin</span><span class="o">/</span><span class="n">pydefect</span><span class="o">/</span><span class="n">pydefect</span><span class="o">/</span><span class="n">main</span><span class="o">.</span><span class="n">py</span> <span class="n">dvs</span>
</pre></div>
</div>
<p>With this command, these directories are created.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">perfect</span><span class="p">,</span> <span class="n">Na_Ba1_</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">Na_Ba1_0</span><span class="p">,</span> <span class="n">Na_Ba1_1</span><span class="p">,</span> <span class="n">Va_Ba1_</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="n">Va_Ba1_</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">Va_Ba1_0</span><span class="p">,</span> 
<span class="n">Va_O1_0</span><span class="p">,</span> <span class="n">Va_O1_1</span><span class="p">,</span> <span class="n">Va_O1_2</span><span class="p">,</span> <span class="n">Va_Sn1_0</span><span class="p">,</span> <span class="n">Va_Sn1_</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">Va_Sn1_</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="n">Va_Sn1_</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="n">Va_Sn1_</span><span class="o">-</span><span class="mi">4</span>
</pre></div>
</div>
<p>If you want to calculate only oxygen vacancies, you can restrict the calculated defects with a regular expression,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="o">~/</span><span class="n">my_bin</span><span class="o">/</span><span class="n">pydefect</span><span class="o">/</span><span class="n">pydefect</span><span class="o">/</span><span class="n">main</span><span class="o">.</span><span class="n">py</span> <span class="n">dvs</span> <span class="o">-</span><span class="n">kw</span> <span class="s2">&quot;Va_O[0-9]?_[0-9]+&quot;</span>
</pre></div>
</div>
<p>With this command, these directories are created.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">perfect</span><span class="p">,</span> <span class="n">Va_O1_0</span><span class="p">,</span> <span class="n">Va_O1_1</span><span class="p">,</span> <span class="n">Va_O1_2</span>
</pre></div>
</div>
<p>If you again type the same command, the following information is shown,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">2019</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">09</span> <span class="mi">17</span><span class="p">:</span><span class="mi">22</span><span class="p">:</span><span class="mi">21</span><span class="p">,</span><span class="mi">044</span> <span class="n">INFO</span> <span class="n">obadb</span><span class="o">.</span><span class="n">vasp</span><span class="o">.</span><span class="n">input_set</span> <span class="n">Band</span> <span class="n">gap</span> <span class="n">info</span><span class="p">:</span> <span class="kc">None</span>
<span class="mi">2019</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">09</span> <span class="mi">17</span><span class="p">:</span><span class="mi">22</span><span class="p">:</span><span class="mi">21</span><span class="p">,</span><span class="mi">057</span> <span class="n">INFO</span> <span class="n">obadb</span><span class="o">.</span><span class="n">vasp</span><span class="o">.</span><span class="n">input_set</span> <span class="n">Magnetization</span><span class="p">:</span> <span class="kc">False</span>
<span class="mi">2019</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">09</span> <span class="mi">17</span><span class="p">:</span><span class="mi">22</span><span class="p">:</span><span class="mi">21</span><span class="p">,</span><span class="mi">078</span> <span class="n">WARNING</span> <span class="n">pydefect</span><span class="o">.</span><span class="n">input_maker</span><span class="o">.</span><span class="n">defect_entry_set_maker</span>    <span class="n">perfect</span> <span class="n">already</span> <span class="n">exists</span><span class="p">,</span> <span class="n">so</span> <span class="n">nothing</span> <span class="ow">is</span> <span class="n">done</span><span class="o">.</span>
<span class="mi">2019</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">09</span> <span class="mi">17</span><span class="p">:</span><span class="mi">22</span><span class="p">:</span><span class="mi">21</span><span class="p">,</span><span class="mi">086</span> <span class="n">INFO</span> <span class="n">obadb</span><span class="o">.</span><span class="n">vasp</span><span class="o">.</span><span class="n">input_set</span> <span class="n">Band</span> <span class="n">gap</span> <span class="n">info</span><span class="p">:</span> <span class="kc">None</span>
<span class="mi">2019</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">09</span> <span class="mi">17</span><span class="p">:</span><span class="mi">22</span><span class="p">:</span><span class="mi">21</span><span class="p">,</span><span class="mi">379</span> <span class="n">INFO</span> <span class="n">obadb</span><span class="o">.</span><span class="n">vasp</span><span class="o">.</span><span class="n">input_set</span> <span class="n">The</span> <span class="n">given</span> <span class="n">structure</span> <span class="ow">is</span> <span class="n">a</span> <span class="n">standardized</span> <span class="n">primitive</span><span class="o">.</span>
<span class="mi">2019</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">09</span> <span class="mi">17</span><span class="p">:</span><span class="mi">22</span><span class="p">:</span><span class="mi">21</span><span class="p">,</span><span class="mi">384</span> <span class="n">INFO</span> <span class="n">obadb</span><span class="o">.</span><span class="n">vasp</span><span class="o">.</span><span class="n">input_set</span> <span class="n">Magnetization</span><span class="p">:</span> <span class="kc">False</span>
<span class="mi">2019</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">09</span> <span class="mi">17</span><span class="p">:</span><span class="mi">22</span><span class="p">:</span><span class="mi">21</span><span class="p">,</span><span class="mi">399</span> <span class="n">WARNING</span> <span class="n">pydefect</span><span class="o">.</span><span class="n">input_maker</span><span class="o">.</span><span class="n">defect_entry_set_maker</span>    <span class="n">Va_O1_0</span> <span class="n">already</span> <span class="n">exists</span><span class="p">,</span> <span class="n">so</span> <span class="n">nothing</span> <span class="ow">is</span> <span class="n">done</span><span class="o">.</span>
<span class="mi">2019</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">09</span> <span class="mi">17</span><span class="p">:</span><span class="mi">22</span><span class="p">:</span><span class="mi">21</span><span class="p">,</span><span class="mi">438</span> <span class="n">INFO</span> <span class="n">obadb</span><span class="o">.</span><span class="n">vasp</span><span class="o">.</span><span class="n">input_set</span> <span class="n">Band</span> <span class="n">gap</span> <span class="n">info</span><span class="p">:</span> <span class="kc">None</span>
<span class="mi">2019</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">09</span> <span class="mi">17</span><span class="p">:</span><span class="mi">22</span><span class="p">:</span><span class="mi">21</span><span class="p">,</span><span class="mi">726</span> <span class="n">INFO</span> <span class="n">obadb</span><span class="o">.</span><span class="n">vasp</span><span class="o">.</span><span class="n">input_set</span> <span class="n">The</span> <span class="n">given</span> <span class="n">structure</span> <span class="ow">is</span> <span class="n">a</span> <span class="n">standardized</span> <span class="n">primitive</span><span class="o">.</span>
<span class="mi">2019</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">09</span> <span class="mi">17</span><span class="p">:</span><span class="mi">22</span><span class="p">:</span><span class="mi">21</span><span class="p">,</span><span class="mi">730</span> <span class="n">INFO</span> <span class="n">obadb</span><span class="o">.</span><span class="n">vasp</span><span class="o">.</span><span class="n">input_set</span> <span class="n">Magnetization</span><span class="p">:</span> <span class="kc">False</span>
<span class="mi">2019</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">09</span> <span class="mi">17</span><span class="p">:</span><span class="mi">22</span><span class="p">:</span><span class="mi">21</span><span class="p">,</span><span class="mi">744</span> <span class="n">WARNING</span> <span class="n">pydefect</span><span class="o">.</span><span class="n">input_maker</span><span class="o">.</span><span class="n">defect_entry_set_maker</span>    <span class="n">Va_O1_1</span> <span class="n">already</span> <span class="n">exists</span><span class="p">,</span> <span class="n">so</span> <span class="n">nothing</span> <span class="ow">is</span> <span class="n">done</span><span class="o">.</span>
<span class="mi">2019</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">09</span> <span class="mi">17</span><span class="p">:</span><span class="mi">22</span><span class="p">:</span><span class="mi">21</span><span class="p">,</span><span class="mi">782</span> <span class="n">INFO</span> <span class="n">obadb</span><span class="o">.</span><span class="n">vasp</span><span class="o">.</span><span class="n">input_set</span> <span class="n">Band</span> <span class="n">gap</span> <span class="n">info</span><span class="p">:</span> <span class="kc">None</span>
<span class="mi">2019</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">09</span> <span class="mi">17</span><span class="p">:</span><span class="mi">22</span><span class="p">:</span><span class="mi">22</span><span class="p">,</span><span class="mi">068</span> <span class="n">INFO</span> <span class="n">obadb</span><span class="o">.</span><span class="n">vasp</span><span class="o">.</span><span class="n">input_set</span> <span class="n">The</span> <span class="n">given</span> <span class="n">structure</span> <span class="ow">is</span> <span class="n">a</span> <span class="n">standardized</span> <span class="n">primitive</span><span class="o">.</span>
<span class="mi">2019</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">09</span> <span class="mi">17</span><span class="p">:</span><span class="mi">22</span><span class="p">:</span><span class="mi">22</span><span class="p">,</span><span class="mi">072</span> <span class="n">INFO</span> <span class="n">obadb</span><span class="o">.</span><span class="n">vasp</span><span class="o">.</span><span class="n">input_set</span> <span class="n">Magnetization</span><span class="p">:</span> <span class="kc">False</span>
<span class="mi">2019</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">09</span> <span class="mi">17</span><span class="p">:</span><span class="mi">22</span><span class="p">:</span><span class="mi">22</span><span class="p">,</span><span class="mi">085</span> <span class="n">WARNING</span> <span class="n">pydefect</span><span class="o">.</span><span class="n">input_maker</span><span class="o">.</span><span class="n">defect_entry_set_maker</span>    <span class="n">Va_O1_2</span> <span class="n">already</span> <span class="n">exists</span><span class="p">,</span> <span class="n">so</span> <span class="n">nothing</span> <span class="ow">is</span> <span class="n">done</span><span class="o">.</span>
</pre></div>
</div>
<p>and no directories are newly created, which is a fail-safe treatment not to delete the calculated directories by mistake.</p>
<p>In each directory, we can find the <code class="docutils literal notranslate"><span class="pre">defect_entry.json</span></code> file, which contains the information about the point defect obtained
before the first-principles calculations.
To see summary of defect_entry.json, type</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="o">~/</span><span class="n">my_bin</span><span class="o">/</span><span class="n">pydefect</span><span class="o">/</span><span class="n">pydefect</span><span class="o">/</span><span class="n">main</span><span class="o">.</span><span class="n">py</span> <span class="n">de</span>
</pre></div>
</div>
</div>
<div class="section" id="generation-of-supercell-information-related-to-point-defect-calculations">
<h2>9. Generation of supercell information related to point-defect calculations<a class="headerlink" href="#generation-of-supercell-information-related-to-point-defect-calculations" title="Permalink to this headline">¶</a></h2>
<p>We next parse the calculation results and generate the <code class="docutils literal notranslate"><span class="pre">dft_results.json</span></code>
that contains the first-principles calculation results related to defect properties.
By typing,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="o">~/</span><span class="n">my_bin</span><span class="o">/</span><span class="n">pydefect</span><span class="o">/</span><span class="n">pydefect</span><span class="o">/</span><span class="n">main</span><span class="o">.</span><span class="n">py</span> <span class="n">sr</span> <span class="o">--</span><span class="n">dir_all</span>
</pre></div>
</div>
<p>you can generate <code class="docutils literal notranslate"><span class="pre">dft_results.json</span></code> in all the directories.</p>
<p>Some calculations might not be finished properly
To see whether the calculations are properly finished, one can use subparse of <code class="docutils literal notranslate"><span class="pre">diagnose</span></code> or <code class="docutils literal notranslate"><span class="pre">d</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="o">~/</span><span class="n">my_bin</span><span class="o">/</span><span class="n">pydefect</span><span class="o">/</span><span class="n">pydefect</span><span class="o">/</span><span class="n">main</span><span class="o">.</span><span class="n">py</span> <span class="n">d</span>
</pre></div>
</div>
<p>which shows like</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>  <span class="n">Va_Ba1_</span><span class="o">-</span><span class="mi">1</span><span class="o">/</span>  <span class="n">convergence</span> <span class="p">:</span> <span class="n">T</span>    <span class="n">band</span> <span class="n">edge</span> <span class="p">:</span> <span class="n">UP</span>  <span class="p">:</span>    <span class="n">No</span> <span class="ow">in</span><span class="o">-</span><span class="n">gap</span> <span class="n">state</span>  <span class="n">DOWN</span>  <span class="p">:</span>       <span class="n">Acceptor</span> <span class="n">PHS</span>
  <span class="n">Va_Ba1_</span><span class="o">-</span><span class="mi">2</span><span class="o">/</span>  <span class="n">convergence</span> <span class="p">:</span> <span class="n">T</span>    <span class="n">band</span> <span class="n">edge</span> <span class="p">:</span> <span class="n">UP</span>  <span class="p">:</span>    <span class="n">No</span> <span class="ow">in</span><span class="o">-</span><span class="n">gap</span> <span class="n">state</span>  <span class="n">DOWN</span>  <span class="p">:</span>    <span class="n">No</span> <span class="ow">in</span><span class="o">-</span><span class="n">gap</span> <span class="n">state</span>
   <span class="n">Va_Ba1_0</span><span class="o">/</span>  <span class="n">No</span> <span class="n">supercell</span> <span class="n">results</span> <span class="n">file</span><span class="o">.</span>
    <span class="n">Va_O1_0</span><span class="o">/</span>  <span class="n">convergence</span> <span class="p">:</span> <span class="n">T</span>    <span class="n">band</span> <span class="n">edge</span> <span class="p">:</span> <span class="n">UP</span>  <span class="p">:</span>    <span class="n">Localized</span> <span class="n">state</span>  <span class="n">DOWN</span>  <span class="p">:</span>    <span class="n">Localized</span> <span class="n">state</span>
    <span class="n">Va_O1_1</span><span class="o">/</span>  <span class="n">convergence</span> <span class="p">:</span> <span class="n">T</span>    <span class="n">band</span> <span class="n">edge</span> <span class="p">:</span> <span class="n">UP</span>  <span class="p">:</span>    <span class="n">Localized</span> <span class="n">state</span>  <span class="n">DOWN</span>  <span class="p">:</span>    <span class="n">Localized</span> <span class="n">state</span>
    <span class="n">Va_O1_2</span><span class="o">/</span>  <span class="n">convergence</span> <span class="p">:</span> <span class="n">T</span>    <span class="n">band</span> <span class="n">edge</span> <span class="p">:</span> <span class="n">UP</span>  <span class="p">:</span>    <span class="n">Localized</span> <span class="n">state</span>  <span class="n">DOWN</span>  <span class="p">:</span>    <span class="n">Localized</span> <span class="n">state</span>
  <span class="n">Va_Sn1_</span><span class="o">-</span><span class="mi">1</span><span class="o">/</span>  <span class="n">convergence</span> <span class="p">:</span> <span class="n">T</span>    <span class="n">band</span> <span class="n">edge</span> <span class="p">:</span> <span class="n">UP</span>  <span class="p">:</span>    <span class="n">No</span> <span class="ow">in</span><span class="o">-</span><span class="n">gap</span> <span class="n">state</span>  <span class="n">DOWN</span>  <span class="p">:</span>    <span class="n">Localized</span> <span class="n">state</span>
  <span class="n">Va_Sn1_</span><span class="o">-</span><span class="mi">2</span><span class="o">/</span>  <span class="n">convergence</span> <span class="p">:</span> <span class="n">T</span>    <span class="n">band</span> <span class="n">edge</span> <span class="p">:</span> <span class="n">UP</span>  <span class="p">:</span>    <span class="n">Localized</span> <span class="n">state</span>  <span class="n">DOWN</span>  <span class="p">:</span>    <span class="n">Localized</span> <span class="n">state</span>
  <span class="n">Va_Sn1_</span><span class="o">-</span><span class="mi">3</span><span class="o">/</span>  <span class="n">convergence</span> <span class="p">:</span> <span class="n">T</span>    <span class="n">band</span> <span class="n">edge</span> <span class="p">:</span> <span class="n">UP</span>  <span class="p">:</span>    <span class="n">Localized</span> <span class="n">state</span>  <span class="n">DOWN</span>  <span class="p">:</span>    <span class="n">Localized</span> <span class="n">state</span>
  <span class="n">Va_Sn1_</span><span class="o">-</span><span class="mi">4</span><span class="o">/</span>  <span class="n">convergence</span> <span class="p">:</span> <span class="n">T</span>    <span class="n">band</span> <span class="n">edge</span> <span class="p">:</span> <span class="n">UP</span>  <span class="p">:</span>    <span class="n">Localized</span> <span class="n">state</span>  <span class="n">DOWN</span>  <span class="p">:</span>    <span class="n">Localized</span> <span class="n">state</span>
   <span class="n">Va_Sn1_0</span><span class="o">/</span>  <span class="n">convergence</span> <span class="p">:</span> <span class="n">T</span>    <span class="n">band</span> <span class="n">edge</span> <span class="p">:</span> <span class="n">UP</span>  <span class="p">:</span>    <span class="n">No</span> <span class="ow">in</span><span class="o">-</span><span class="n">gap</span> <span class="n">state</span>  <span class="n">DOWN</span>  <span class="p">:</span>    <span class="n">Localized</span> <span class="n">state</span>
</pre></div>
</div>
<p>If the convergences at the electronic and/or ionic step are not attained, convergence becomes <code class="docutils literal notranslate"><span class="pre">F</span></code>.
After the convergence, we can see band edge information, which will be explained later.</p>
</div>
<div class="section" id="corrections-of-defect-formation-energies-in-finite-size-supercell">
<h2>10. Corrections of defect formation energies in finite-size supercell<a class="headerlink" href="#corrections-of-defect-formation-energies-in-finite-size-supercell" title="Permalink to this headline">¶</a></h2>
<p>Because of the background charge and image charges, the obtained total energies for <strong>charged defects</strong> are not proper.
Therefore, we need to correct the energies to those in dilute limit.
The corrections are attained by using subparse extended_fnv_correction or efc,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="o">~/</span><span class="n">my_bin</span><span class="o">/</span><span class="n">pydefect</span><span class="o">/</span><span class="n">pydefect</span><span class="o">/</span><span class="n">main</span><span class="o">.</span><span class="n">py</span> <span class="n">efc</span> <span class="o">--</span><span class="n">unitcell_json</span> <span class="o">../</span><span class="n">unitcell</span><span class="o">/</span><span class="n">unitcell</span><span class="o">.</span><span class="n">json</span> <span class="o">--</span><span class="n">perfect_json</span> <span class="n">perfect</span><span class="o">/</span><span class="n">dft_results</span><span class="o">.</span><span class="n">json</span>
</pre></div>
</div>
<p>For the corrections, we need the dielectric constants and atomic site potential of perfect supercell.
Therefore, the paths to <code class="docutils literal notranslate"><span class="pre">unitcell.json</span></code> and <code class="docutils literal notranslate"><span class="pre">dft_results.json</span></code> of <code class="docutils literal notranslate"><span class="pre">perfect</span></code> are assigned.
Bear also in mind that this command takes some time.</p>
</div>
<div class="section" id="check-defect-eigenvalues">
<h2>11. Check defect eigenvalues<a class="headerlink" href="#check-defect-eigenvalues" title="Permalink to this headline">¶</a></h2>
<p>Generally, wavefunctions of perturbed host states (PHS) widespread to several million atoms, and
it is therefore not straightforward to estimate the thermodynamical transition levels of these PHS.
Instead, we recommend to show that defects have PHS and their transition energies locate near band edges qualitatively.</p>
<p>For this purpose, we need to determine if the carriers occupy the PHS or defect localized states.
And PyDefect suggest the band-edge states as shown above using diagnose.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="o">~/</span><span class="n">my_bin</span><span class="o">/</span><span class="n">pydefect</span><span class="o">/</span><span class="n">pydefect</span><span class="o">/</span><span class="n">main</span><span class="o">.</span><span class="n">py</span> <span class="n">eig</span> <span class="o">--</span><span class="n">defect_dir</span> <span class="o">.</span> <span class="o">--</span><span class="n">unitcell</span> <span class="o">../../</span><span class="n">unitcell</span><span class="o">/</span><span class="n">unitcell</span><span class="o">.</span><span class="n">json</span> <span class="o">--</span><span class="n">perfect</span> <span class="o">../</span><span class="n">perfect</span><span class="o">/</span><span class="n">dft_results</span><span class="o">.</span><span class="n">json</span> <span class="o">-</span><span class="n">s</span> <span class="n">eig</span><span class="o">.</span><span class="n">png</span>
</pre></div>
</div>
</div>
<div class="section" id="plot-defect-formation-energies">
<h2>12. Plot defect formation energies<a class="headerlink" href="#plot-defect-formation-energies" title="Permalink to this headline">¶</a></h2>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Tutorial of pydefect</a><ul>
<li><a class="reference internal" href="#relaxation-of-unit-cell">1. Relaxation of unit cell</a></li>
<li><a class="reference internal" href="#calculation-of-band-dos-and-dielectric-tensor">2. Calculation of band, DOS, and dielectric tensor</a></li>
<li><a class="reference internal" href="#gathering-unitcell-information-related-to-point-defect-calculations">3. Gathering unitcell information related to point-defect calculations</a></li>
<li><a class="reference internal" href="#calculation-of-competing-phases">4. Calculation of competing phases</a></li>
<li><a class="reference internal" href="#select-of-a-supercell">5. Select of a supercell</a></li>
<li><a class="reference internal" href="#construction-of-defect-initial-setting">6. Construction of defect initial setting</a></li>
<li><a class="reference internal" href="#decision-of-interstitial-sites">7. Decision of interstitial sites</a></li>
<li><a class="reference internal" href="#creation-of-defect-calculation-directories">8. Creation of defect calculation directories</a></li>
<li><a class="reference internal" href="#generation-of-supercell-information-related-to-point-defect-calculations">9. Generation of supercell information related to point-defect calculations</a></li>
<li><a class="reference internal" href="#corrections-of-defect-formation-energies-in-finite-size-supercell">10. Corrections of defect formation energies in finite-size supercell</a></li>
<li><a class="reference internal" href="#check-defect-eigenvalues">11. Check defect eigenvalues</a></li>
<li><a class="reference internal" href="#plot-defect-formation-energies">12. Plot defect formation energies</a></li>
</ul>
</li>
</ul>

  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/tutorial.md.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="nav-item nav-item-0"><a href="index.html">pydefect beta documentation</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2019, Yu Kumagai.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 2.1.2.
    </div>
  </body>
</html>