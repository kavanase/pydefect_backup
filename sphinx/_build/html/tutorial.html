
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Tutorial of pydefect &#8212; pydefect beta documentation</title>
    <link rel="stylesheet" href="_static/corlab.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/language_data.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="nav-item nav-item-0"><a href="index.html">pydefect beta documentation</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="tutorial-of-pydefect">
<h1>Tutorial of pydefect<a class="headerlink" href="#tutorial-of-pydefect" title="Permalink to this headline">¶</a></h1>
<hr class="docutils" />
<p>We here illustrate how to use the pydefect code.</p>
<p><strong>Note1: Pydefect supports only the vienna ab-initio simulation package (VASP) and so we suppose the file names (e.g., POSCAR, POTCAR) and computational techniques (e.g., periodic boundary condition) used in VASP.</strong></p>
<p><strong>Note2: Units used in pydefect are eV for energy and <span>Å</span> for length following the vasp convention.</strong></p>
<p><strong>Note3: Only nonmagnetic host materials are allowed.</strong></p>
<p>Usually, point-defect calculations in non-metallic solids are intricate as shown in the workflow below;
some tasks can be performed concurrently, while others must follow some other tasks.</p>
<p><img alt="_images/flowchart.png" src="_images/flowchart.png" /></p>
<p>Here, we suppose the following directory tree.
The <code class="docutils literal notranslate"><span class="pre">&lt;project_name&gt;</span></code> is usually the name of material or that with crystal structure, e.g., rutile-TiO<sub>2</sub>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;project_name&gt;
 │
 ├ pydefect.yaml
 │
 ├ unitcell/ ── structure_opt/
 │            ├ band/
 │            └ dos/
 │            
 ├ competing_phases/ ── &lt;competing_phase 1&gt;
 │                    ├── &lt;competing_phase 2&gt;
 │                    ....
 │  
 └ defects/ ── perfect/  
              ├─ Va_X_0/
              ├─ Va_X_1/
              ├─ Va_X_2/
             ...
</pre></div>
</div>
<p>We recommend the users to follow the same directory structure as the default of <code class="docutils literal notranslate"><span class="pre">pydefect</span></code> assumes it.
Details of the process are examined step by step using an example of MgO calculated using the PBEsol functional, which is a default of <code class="docutils literal notranslate"><span class="pre">pydefect</span></code>.
Other examples are also shown in the subsequent tutorials.</p>
<div class="section" id="relaxation-of-unit-cell">
<h2>1. Relaxation of unit cell<a class="headerlink" href="#relaxation-of-unit-cell" title="Permalink to this headline">¶</a></h2>
<p>Point-defect calculations are generally performed at a fully relaxed structures by the given functional and projector augmented wave (PAW) potentials.
This allows us to avoid the artificial strain and stress which is responsible for the unwanted supercell size dependence.
Therefore, one usually begins with optimizing lattice constants and fractional coordinates of atomic positions in the unitcell.</p>
<p>We first prepare <code class="docutils literal notranslate"><span class="pre">POSCAR</span></code> of the pristine bulk unitcell, and create <code class="docutils literal notranslate"><span class="pre">unitcell/</span></code> directory and <code class="docutils literal notranslate"><span class="pre">unitcell/structure_opt/</span></code> sub-directory and move there.
In this tutorial, <code class="docutils literal notranslate"><span class="pre">/</span></code> means a directory at any time.
<code class="docutils literal notranslate"><span class="pre">pydefect</span></code> can construct the vasp input files, namely INCAR, POTCAR, KPOINTS files, for various tasks and exchange-correlation (XC) functionals with simple command line tools.
For instance, vasp input files to optimize unitcell using the PBEsol functional are generated by the following command.
Here, the pbesol functional is a default, so if one wants to change the XC functional, use the <code class="docutils literal notranslate"><span class="pre">-x</span></code> option.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>python $PATH_TO_PYDEFECT/pydefect/main.py vasp_oba_set -t structure_opt
</pre></div>
</div>
<p>where <code class="docutils literal notranslate"><span class="pre">vasp_oba_set</span></code>, or its abbreviation (<code class="docutils literal notranslate"><span class="pre">vos</span></code>) , is a sub-command option of pydefect.
In pydefect, all the sub-commands have their own abbreviations, which would be better for advanced users.</p>
<p>When <code class="docutils literal notranslate"><span class="pre">pydefect</span></code> creates vasp input files, analyze or visualize vasp output files,
the <code class="docutils literal notranslate"><span class="pre">VISE</span></code> (=<code class="docutils literal notranslate"><span class="pre">vasp</span> <span class="pre">integrated</span> <span class="pre">supporting</span> <span class="pre">environment</span></code>) library, written by Kumagai largely on the basis of <a class="reference external" href="http://pymatgen.org">pymatgen</a> developed by Materials Project team, is adopted.
Therefore, as shown <a class="reference external" href="https://pymatgen.org/usage.html">pymatgen web page 1</a> or <a class="reference external" href="https://pymatgen.org/_modules/pymatgen/io/vasp/inputs.html">2</a>,
we need to set the PMG_DEFAULT_FUNCTIONAL and PMG_VASP_PSP_DIR in the .pmgrc.yaml file at the home directory, e.g.,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PMG_DEFAULT_FUNCTIONAL</span><span class="p">:</span> <span class="n">PBE_54</span>
<span class="n">PMG_MAPI_KEY</span><span class="p">:</span> <span class="n">xxxxxxxxxxxxxxxx</span>
<span class="n">PMG_VASP_PSP_DIR</span><span class="p">:</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">kumagai</span><span class="o">/</span><span class="n">potcars</span><span class="o">/</span>
</pre></div>
</div>
<p>Here, <code class="docutils literal notranslate"><span class="pre">PMG_MAPI_KEY</span></code> is required for querying <code class="docutils literal notranslate"><span class="pre">POSCAR</span></code>s of competing materials as shown later.</p>
<p>In <code class="docutils literal notranslate"><span class="pre">VaspObaSet</span></code> in <code class="docutils literal notranslate"><span class="pre">VISE</span></code>, we provide the default <code class="docutils literal notranslate"><span class="pre">POTCAR</span></code> set regularly we use, but of course, users can adopt their favorite <code class="docutils literal notranslate"><span class="pre">POTCAR</span></code> set.
In <code class="docutils literal notranslate"><span class="pre">pydefect</span></code>, users can control various types of parameters using the <code class="docutils literal notranslate"><span class="pre">pydefect.yaml</span></code> file.
For example, for <code class="docutils literal notranslate"><span class="pre">vasp_oba_set</span></code> and <code class="docutils literal notranslate"><span class="pre">defect_vasp_oba_set</span></code> which appear later, we can use <code class="docutils literal notranslate"><span class="pre">potcar_set</span></code> key as follows
If you write <code class="docutils literal notranslate"><span class="pre">my_potcar.yaml</span></code> as</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">potcar_set</span><span class="p">:</span> <span class="n">Mg_pv</span> <span class="n">O_h</span>
</pre></div>
</div>
<p>Then, the Mg_pv and O_h <code class="docutils literal notranslate"><span class="pre">POTCAR</span></code> files are used insteadof normal Mg and O <code class="docutils literal notranslate"><span class="pre">POTCAR</span></code> files.</p>
<p>Note that <code class="docutils literal notranslate"><span class="pre">pydefect</span></code> tries to find the <code class="docutils literal notranslate"><span class="pre">pydefect.yaml</span></code> file from the current working directory to the parent directly up to the home or root directory.
Therefore, when <code class="docutils literal notranslate"><span class="pre">pydefect.yaml</span></code> is located at the top directory of the project as shown above directory tree,
the parameters are always used for the <code class="docutils literal notranslate"><span class="pre">pydefect</span></code> commands.
There are so many keys for <code class="docutils literal notranslate"><span class="pre">pydefect.yaml</span></code>, which is shown here.
For example, one can use</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">xc</span><span class="p">:</span> <span class="n">hse</span>
</pre></div>
</div>
<p>for XC functional.</p>
<p>There are also many options for each sub-command, so please refer its help by e.g.,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="o">~/</span><span class="n">my_bin</span><span class="o">/</span><span class="n">pydefect</span><span class="o">/</span><span class="n">pydefect</span><span class="o">/</span><span class="n">main</span><span class="o">.</span><span class="n">py</span> <span class="n">vos</span> <span class="o">-</span><span class="n">h</span>
</pre></div>
</div>
<p>for details.</p>
<p>Note that the structure optimization must be generally iterated with 1.3 times larger cutoff energy
until the forces and stresses converge at the first ionic step so as to reduce the errors caused by the Pulay Stress to an acceptable accuracy.
See <a class="reference external" href="https://cms.mpi.univie.ac.at/vasp/vasp/Volume_vs_energy_volume_relaxations_Pulay_Stress.html">vasp manual</a> or <a class="reference external" href="https://cms.mpi.univie.ac.at/vasp/vasp/Volume_vs_energy_volume_relaxations_Pulay_Stress.html">wikipedia</a> for details.
Note that such iteration of the vasp calculations is not supported by pydefect, but one can easily write the simple runshell scripts to do so.</p>
</div>
<div class="section" id="calculation-of-band-dos-and-dielectric-tensor">
<h2>2. Calculation of band, DOS, and dielectric tensor<a class="headerlink" href="#calculation-of-band-dos-and-dielectric-tensor" title="Permalink to this headline">¶</a></h2>
<p>We then calculate the band structure (BS), density of states (DOS), and dielectric constant.
In the defect calculations, the BS and DOS are used for determining the valence band maximum (VBM) and conduction band minimum (CBM),
while the dielectric constant, a sum of electronic and ionic dielectric tensors, is needed for correcting the defect formation energies and eigenvalues of defect-induced deep states.</p>
<p>First, we create <code class="docutils literal notranslate"><span class="pre">band/</span></code>, <code class="docutils literal notranslate"><span class="pre">dos/</span></code> and <code class="docutils literal notranslate"><span class="pre">dielectric/</span></code> in <code class="docutils literal notranslate"><span class="pre">unitcell/</span></code> and copy POSCAR from <code class="docutils literal notranslate"><span class="pre">unitcell/structure_opt</span></code> and type the following command in each directory,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="o">~/</span><span class="n">my_bin</span><span class="o">/</span><span class="n">pydefect</span><span class="o">/</span><span class="n">pydefect</span><span class="o">/</span><span class="n">main</span><span class="o">.</span><span class="n">py</span> <span class="n">vos</span> <span class="o">-</span><span class="n">t</span> <span class="n">band</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="o">~/</span><span class="n">my_bin</span><span class="o">/</span><span class="n">pydefect</span><span class="o">/</span><span class="n">pydefect</span><span class="o">/</span><span class="n">main</span><span class="o">.</span><span class="n">py</span> <span class="n">vos</span> <span class="o">-</span><span class="n">t</span> <span class="n">dos</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="o">~/</span><span class="n">my_bin</span><span class="o">/</span><span class="n">pydefect</span><span class="o">/</span><span class="n">pydefect</span><span class="o">/</span><span class="n">main</span><span class="o">.</span><span class="n">py</span> <span class="n">vos</span> <span class="o">-</span><span class="n">t</span> <span class="n">dielectric</span>
</pre></div>
</div>
<p>and run the vasp calculations.</p>
<p>Here, the band path is determined based upon the <a class="reference external" href="https://www.materialscloud.org/work/tools/seekpath">seekpath code</a>,
so if one uses the plot for publication or presentation, please cite the following paper.</p>
<ul class="simple">
<li><p><a class="reference external" href="https://www.sciencedirect.com/science/article/pii/S0927025616305110?via%3Dihub">Y. Hinuma, G. Pizzi, Y. Kumagai, F. Oba, I. Tanaka, Band structure diagram paths based on crystallography, Comp. Mat. Sci. 128, 140 (2017).</a>
DOI: 10.1016/j.commatsci.2016.10.015 (the “HPKOT” paper; arXiv version: arXiv:1602.06402).</p></li>
</ul>
<p>pydefect also provides the plotters of BS and DOS based on <code class="docutils literal notranslate"><span class="pre">VaspObaSet</span></code> with <code class="docutils literal notranslate"><span class="pre">plot_band</span></code> (=<code class="docutils literal notranslate"><span class="pre">pb</span></code>) and <code class="docutils literal notranslate"><span class="pre">plot_dos</span></code> (=<code class="docutils literal notranslate"><span class="pre">pd</span></code>) sub-commands.
Type the following commands in <code class="docutils literal notranslate"><span class="pre">band/</span></code> and  <code class="docutils literal notranslate"><span class="pre">dos/</span></code>, respectively.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="o">~/</span><span class="n">my_bin</span><span class="o">/</span><span class="n">phos_pbesol</span><span class="o">/</span><span class="n">obadb</span><span class="o">/</span><span class="n">obadb</span><span class="o">/</span><span class="n">analyzer</span><span class="o">/</span><span class="n">main</span><span class="o">.</span><span class="n">py</span> <span class="n">pb</span> <span class="o">-</span><span class="n">v</span> <span class="n">vasprun</span><span class="o">.</span><span class="n">xml</span> <span class="o">-</span><span class="n">k</span> <span class="n">KPOINTS</span> <span class="o">-</span><span class="n">f</span> <span class="n">band</span><span class="o">.</span><span class="n">pdf</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="o">~/</span><span class="n">my_bin</span><span class="o">/</span><span class="n">phos_pbesol</span><span class="o">/</span><span class="n">obadb</span><span class="o">/</span><span class="n">obadb</span><span class="o">/</span><span class="n">analyzer</span><span class="o">/</span><span class="n">main</span><span class="o">.</span><span class="n">py</span> <span class="n">pd</span> <span class="o">-</span><span class="n">v</span> <span class="n">vasprun</span><span class="o">.</span><span class="n">xml</span> <span class="o">-</span><span class="n">f</span> <span class="n">dos</span><span class="o">.</span><span class="n">pdf</span>
</pre></div>
</div>
</div>
<div class="section" id="gathering-unitcell-information-related-to-point-defect-calculations">
<h2>3. Gathering unitcell information related to point-defect calculations<a class="headerlink" href="#gathering-unitcell-information-related-to-point-defect-calculations" title="Permalink to this headline">¶</a></h2>
<p>We next collect the bulk information relevant to point-defect calculations, namely band edges (for defect-formation energies),
electronic and ionic contributions to dielectric tensor (for corrections), unitcell volume, and unitcell DOS (both for carrier and defect concentrations),
using the <code class="docutils literal notranslate"><span class="pre">unitcell_results</span></code> (=<code class="docutils literal notranslate"><span class="pre">ur</span></code>) sub-command.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="o">~/</span><span class="n">my_bin</span><span class="o">/</span><span class="n">pydefect</span><span class="o">/</span><span class="n">pydefect</span><span class="o">/</span><span class="n">main</span><span class="o">.</span><span class="n">py</span> <span class="n">ur</span> <span class="o">--</span><span class="n">static_diele_dir</span> <span class="n">dielectric</span> <span class="o">--</span><span class="n">ionic_diele_dir</span> <span class="n">dielectric</span> <span class="o">--</span><span class="n">band_edge_dir</span> <span class="n">band</span> <span class="o">--</span><span class="n">volume_dir</span> <span class="n">dielectric</span> <span class="o">--</span><span class="n">total_dos_dir</span> <span class="n">dos</span> <span class="o">--</span><span class="n">json_file</span> <span class="n">unitcell</span><span class="o">.</span><span class="n">json</span> <span class="o">-</span><span class="n">o</span> <span class="n">OUTCAR</span><span class="o">-</span><span class="n">finish</span> <span class="o">-</span><span class="n">p</span> <span class="n">POSCAR</span><span class="o">-</span><span class="n">finish</span> <span class="o">-</span><span class="n">v</span> <span class="n">vasprun</span><span class="o">.</span><span class="n">xml</span>
</pre></div>
</div>
<p>In this command, we suppose that OUTCAR and CONTCAR are renamed to OUTCAR-finish and POSCAR-finish, respectively, as an example, using <code class="docutils literal notranslate"><span class="pre">-o</span></code> and <code class="docutils literal notranslate"><span class="pre">-p</span></code> options.
If you write the following in the <code class="docutils literal notranslate"><span class="pre">pydefect.yaml</span></code> file,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># VASP file names</span>
<span class="n">outcar</span><span class="p">:</span> <span class="n">OUTCAR</span><span class="o">-</span><span class="n">finish</span>
<span class="n">contcar</span><span class="p">:</span> <span class="n">POSCAR</span><span class="o">-</span><span class="n">finish</span>
<span class="n">vasprun</span><span class="p">:</span> <span class="n">vasprun</span><span class="o">.</span><span class="n">xml</span>
<span class="n">procar</span><span class="p">:</span> <span class="n">PROCAR</span>
<span class="c1"># directory names</span>
<span class="n">volume_dir</span><span class="p">:</span> <span class="n">unitcell</span><span class="o">/</span><span class="n">structure_opt</span>
<span class="n">static_diele_dir</span><span class="p">:</span> <span class="n">unitcell</span><span class="o">/</span><span class="n">dielectric</span>
<span class="n">ionic_diele_dir</span><span class="p">:</span> <span class="n">unitcell</span><span class="o">/</span><span class="n">dielectric</span>
<span class="n">band_edge_dir</span><span class="p">:</span> <span class="n">unitcell</span><span class="o">/</span><span class="n">band</span>
<span class="n">dos_dir</span><span class="p">:</span> <span class="n">unitcell</span><span class="o">/</span><span class="n">dos</span>
</pre></div>
</div>
<p>it’s okay to simply type</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="o">~/</span><span class="n">my_bin</span><span class="o">/</span><span class="n">pydefect</span><span class="o">/</span><span class="n">pydefect</span><span class="o">/</span><span class="n">main</span><span class="o">.</span><span class="n">py</span> <span class="n">ur</span>
</pre></div>
</div>
<p>With this command, <code class="docutils literal notranslate"><span class="pre">unitcell.json</span></code> is generated, which will be used for the analysis later.
Generally, json files are less readable for human beings, so we implement <code class="docutils literal notranslate"><span class="pre">print</span></code> option to generate readable output from json files, like</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="o">~/</span><span class="n">my_bin</span><span class="o">/</span><span class="n">pydefect</span><span class="o">/</span><span class="n">pydefect</span><span class="o">/</span><span class="n">main</span><span class="o">.</span><span class="n">py</span> <span class="n">ur</span> <span class="o">--</span><span class="nb">print</span>
</pre></div>
</div>
<p>Here, we show an example of the unitcell information.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">vbm</span> <span class="p">(</span><span class="n">eV</span><span class="p">):</span> <span class="mf">3.067</span>
<span class="n">cbm</span> <span class="p">(</span><span class="n">eV</span><span class="p">):</span> <span class="mf">7.726</span>
<span class="n">static</span> <span class="n">dielectric</span> <span class="n">tensor</span><span class="p">:</span> 
 <span class="p">[</span><span class="mf">3.16</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]</span>
 <span class="p">[</span><span class="o">-</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">3.16</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]</span>
 <span class="p">[</span><span class="o">-</span><span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">3.16</span><span class="p">]</span>
<span class="n">ionic</span> <span class="n">dielectric</span> <span class="n">tensor</span><span class="p">:</span> 
 <span class="p">[</span><span class="mf">6.81</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0</span><span class="p">]</span>
 <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">6.81</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0</span><span class="p">]</span>
 <span class="p">[</span><span class="o">-</span><span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">6.81</span><span class="p">]</span>
<span class="n">total</span> <span class="n">dielectric</span> <span class="n">tensor</span><span class="p">:</span> 
 <span class="p">[</span><span class="mf">9.97</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]</span>
 <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">9.97</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]</span>
 <span class="p">[</span><span class="o">-</span><span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">9.97</span><span class="p">]</span>
<span class="n">volume</span> <span class="p">(</span><span class="n">A</span><span class="o">^</span><span class="mi">3</span><span class="p">):</span> <span class="mf">18.65</span>
<span class="n">Total</span> <span class="n">DOS</span><span class="p">:</span> <span class="n">Exists</span>
</pre></div>
</div>
<p>Since the total dos is so long, we show only whether it is set or not.</p>
</div>
<div class="section" id="calculation-of-competing-phases">
<h2>4. Calculation of competing phases<a class="headerlink" href="#calculation-of-competing-phases" title="Permalink to this headline">¶</a></h2>
<p>When a defect is introduced, atoms are exchanged with the hypothetical atomic reservoirs within the thermodynamics framework.
In order to calculate a free energy of defect formation that is approximated with the defect formation energy in most cases,
we need to set chemical potentials of exchanged atoms accompanied with creating defects.
Usually, we consider the chemical potentials at the condition where competing phases coexist with the host material,
which are determined from the chemical potential diagram.</p>
<p>First, we create directories in <code class="docutils literal notranslate"><span class="pre">competing_phases/</span></code> for competing phases including VASP input sets in each directory.
Using the <code class="docutils literal notranslate"><span class="pre">chempotdiag</span></code> library developed and managed by Akira Takahashi,
we can retrieve POSCARs of the stable or slightly unstable competing phases from <a class="reference external" href="https://materialsproject.org">the Materials Project (MP)</a>.
For this purpose, one needs <a class="reference external" href="https://materialsproject.org/open">the API keys</a> of the MP as mentioned above.
Here, as an example, we obtain the competing materials with BaSnO of which energy above hull is less than 0.5 meV/atom using</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="o">~/</span><span class="n">my_bin</span><span class="o">/</span><span class="n">phos_pbesol</span><span class="o">/</span><span class="n">obadb</span><span class="o">/</span><span class="n">obadb</span><span class="o">/</span><span class="n">analyzer</span><span class="o">/</span><span class="n">chempotdiag</span><span class="o">/</span><span class="n">main</span><span class="o">.</span><span class="n">py</span> <span class="n">cpd</span> <span class="o">-</span><span class="n">m</span> <span class="o">-</span><span class="n">el</span> <span class="n">Mg</span> <span class="n">O</span> <span class="o">-</span><span class="n">ch</span> <span class="mf">0.0</span>
</pre></div>
</div>
<p>Particular molecules, namely O<sub>2</sub>, N<sub>2</sub>, F<sub>2</sub>, H<sub>2</sub>O, N<sub>2</sub>, NH<sub>3</sub>, NO<sub>2</sub>, P<sub>2</sub>, and P<sub>4</sub>,
are not retrieved from MP but created by <code class="docutils literal notranslate"><span class="pre">chempotdiag</span></code> itself since these molecules have been calculated as solids in MP.</p>
<p>The bulk structure, namely BaSnO<sub>3</sub> in this example, has already been calculated, so we do not have to iterate the same calculations.
Therefore, we simply remove <code class="docutils literal notranslate"><span class="pre">Mg1O1_mp-126</span></code> and make a symbolic link by <code class="docutils literal notranslate"><span class="pre">ln</span> <span class="pre">-s</span> <span class="pre">../unitcell/structure_opt</span> <span class="pre">MgO</span></code>.
At this point, you can find these directories (at 2019/8/28),</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Mg4O8_mp</span><span class="o">-</span><span class="mi">2589</span><span class="o">/</span>  <span class="n">Mg9_mp</span><span class="o">-</span><span class="mi">1094122</span><span class="o">/</span>  <span class="n">MgO</span><span class="o">@</span>  <span class="n">O2molecule_pydefect</span><span class="o">/</span>
</pre></div>
</div>
<p>We then generate <code class="docutils literal notranslate"><span class="pre">INCAR</span></code>, <code class="docutils literal notranslate"><span class="pre">POTCAR</span></code>, <code class="docutils literal notranslate"><span class="pre">KPOINTS</span></code> files for other competing solids or molecules.
In order to compare the total energies, we need to use the same cutoff energy, <code class="docutils literal notranslate"><span class="pre">ENCUT</span></code>, increased to 1.3 times of max <code class="docutils literal notranslate"><span class="pre">ENMAX</span></code> between the constituent POTCARs.
In case of MgO, <code class="docutils literal notranslate"><span class="pre">ENMAX</span></code> of Mg and O are 200.000 and 400.0, so we need to set <code class="docutils literal notranslate"><span class="pre">ENCUT</span> <span class="pre">=</span> <span class="pre">520</span></code>, using the <code class="docutils literal notranslate"><span class="pre">vasp_oba_set</span></code> sub-command</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="o">~/</span><span class="n">my_bin</span><span class="o">/</span><span class="n">pydefect</span><span class="o">/</span><span class="n">pydefect</span><span class="o">/</span><span class="n">main</span><span class="o">.</span><span class="n">py</span> <span class="n">vos</span> <span class="o">-</span><span class="n">t</span> <span class="n">structure_opt</span> <span class="o">-</span><span class="n">x</span> <span class="n">pbesol</span> <span class="o">-</span><span class="ow">is</span> <span class="n">ENCUT</span> <span class="mi">520</span> <span class="o">--</span><span class="n">dirs</span> <span class="o">*</span><span class="n">_</span><span class="o">*/</span>
</pre></div>
</div>
<p>Note, if competing phases are gases, we need to change `ISIF` to 2 so as not to relax the lattice constants (see [vasp manual](https://cms.mpi.univie.ac.at/wiki/index.php/ISIF)), 
and `KPOINTS` requires only the &Gamma; point sampling.</p><p>In such case, type as follows,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="o">~/</span><span class="n">my_bin</span><span class="o">/</span><span class="n">pydefect</span><span class="o">/</span><span class="n">pydefect</span><span class="o">/</span><span class="n">main</span><span class="o">.</span><span class="n">py</span> <span class="n">vos</span> <span class="o">-</span><span class="n">t</span> <span class="n">structure_opt</span> <span class="o">-</span><span class="n">x</span> <span class="n">pbesol</span> <span class="o">-</span><span class="ow">is</span> <span class="n">ENCUT</span> <span class="mi">520</span> <span class="n">ISIF</span> <span class="mi">2</span> <span class="o">-</span><span class="n">vos_kw</span> <span class="n">is_cluster</span> <span class="kc">True</span> <span class="o">--</span><span class="n">dirs</span> <span class="n">O2molecule_pydefect</span>
</pre></div>
</div>
<p>where O2molecule_pydefect is a directory for the O2 molecule model.</p>
<p>After finishing the vasp calculations, we generate the chemical potential diagram with</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="o">~/</span><span class="n">my_bin</span><span class="o">/</span><span class="n">phos_pbesol</span><span class="o">/</span><span class="n">obadb</span><span class="o">/</span><span class="n">obadb</span><span class="o">/</span><span class="n">analyzer</span><span class="o">/</span><span class="n">chempotdiag</span><span class="o">/</span><span class="n">main</span><span class="o">.</span><span class="n">py</span> <span class="n">cpd</span> <span class="o">-</span><span class="n">v</span> <span class="o">*/</span> <span class="o">-</span><span class="n">p</span> <span class="n">POSCAR</span><span class="o">-</span><span class="n">finish</span> <span class="o">-</span><span class="n">o</span> <span class="n">OUTCAR</span><span class="o">-</span><span class="n">finish</span> <span class="o">-</span><span class="n">c</span> <span class="n">MgO</span> <span class="o">-</span><span class="n">y</span> <span class="o">-</span><span class="n">s</span> <span class="n">cpd</span><span class="o">.</span><span class="n">pdf</span>
</pre></div>
</div>
<p>Note that for gas phases there are some parameters of the partial pressure and temperature to determine the chemical potentials (read help for more details).
With this command, we depict the Mg-O chemical potential diagram saved as <code class="docutils literal notranslate"><span class="pre">cpd.pdf</span></code> which looks like</p>
<p><img alt="_images/cpd_MgO.png" src="_images/cpd_MgO.png" /></p>
<p>In ternary case, it looks like
<img alt="_images/cpd_BaSnO3.png" src="_images/cpd_BaSnO3.png" /></p>
<p>Values at the vertices at the BaSnO<sub>3</sub> region written in <code class="docutils literal notranslate"><span class="pre">vertices_BaSnO3.yaml</span></code> as shown</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">A</span><span class="p">:</span> <span class="p">{</span><span class="n">Mg</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">O</span><span class="p">:</span> <span class="o">-</span><span class="mf">5.910971904865118</span><span class="p">}</span>
<span class="n">B</span><span class="p">:</span> <span class="p">{</span><span class="n">Mg</span><span class="p">:</span> <span class="o">-</span><span class="mf">5.847874231666665</span><span class="p">,</span> <span class="n">O</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.06309767319845339</span><span class="p">}</span>
<span class="n">compound</span><span class="p">:</span> <span class="n">MgO</span>
<span class="n">pressure</span><span class="p">:</span> <span class="n">null</span>
<span class="n">standard_energy</span><span class="p">:</span> <span class="p">{</span><span class="n">Mg</span><span class="p">:</span> <span class="o">-</span><span class="mf">1.7294249733333331</span><span class="p">,</span> <span class="n">O</span><span class="p">:</span> <span class="o">-</span><span class="mf">4.8720259618015485</span><span class="p">}</span>
<span class="n">temperature</span><span class="p">:</span> <span class="mi">0</span>
</pre></div>
</div>
<p>Here, <code class="docutils literal notranslate"><span class="pre">standard_energy</span></code> are the energies of the most stable simple substances or simple gas phases,
and A–B show the relative chemical potentials at the vertices shown in <code class="docutils literal notranslate"><span class="pre">cpd_MgO.pdf</span></code>.</p>
</div>
<div class="section" id="selection-of-a-supercell">
<h2>5. Selection of a supercell<a class="headerlink" href="#selection-of-a-supercell" title="Permalink to this headline">¶</a></h2>
<p>So far, we have finished the calculations of the unit cell and competing phases, and are eventually ready for point-defect calculations.
Let’s create <code class="docutils literal notranslate"><span class="pre">defect/</span></code> directory and copy unitcell <code class="docutils literal notranslate"><span class="pre">POSCAR</span></code> file from <em>e.g.</em> <code class="docutils literal notranslate"><span class="pre">unitcell/dos/</span></code> to <code class="docutils literal notranslate"><span class="pre">defect/</span></code></p>
<p>Firstly, we need to determine the shape and size of the supercell.
pydefect recommends a nearly isotropic supercell composed of moderate number of atoms.
For this purpose, use the <code class="docutils literal notranslate"><span class="pre">recommend_supercell</span></code> (=<code class="docutils literal notranslate"><span class="pre">rs</span></code>) sub-command,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="o">~/</span><span class="n">my_bin</span><span class="o">/</span><span class="n">pydefect</span><span class="o">/</span><span class="n">pydefect</span><span class="o">/</span><span class="n">main</span><span class="o">.</span><span class="n">py</span> <span class="n">rs</span>
</pre></div>
</div>
<p>Then, <code class="docutils literal notranslate"><span class="pre">UPOSCAR</span></code> and <code class="docutils literal notranslate"><span class="pre">SPOSCAR</span></code> that are the POSCARs for the unitcell and supercell, respectively, are generated.</p>
<p>Although pydefect constructs <code class="docutils literal notranslate"><span class="pre">SPOSCAR</span></code> based on the <em>conventional</em> unitcell by default,
it can also expand the <em>primitive</em> unitcell with <code class="docutils literal notranslate"><span class="pre">-pr</span></code> option.
(If centering is absent, these two are the same.)</p>
<p>It is also possible to change the lattice angle of the supercell from those of the conventional or primitive unitcell,
but not a good idea for point-defect calculations.
For example, we can make a supercell in which a-, b-, and c-axes are mutually orthogonal.
However, its lattice breaks the original hexagonal symmetry, which reduces the accuracy of the point-defect calculations.</p>
</div>
<div class="section" id="construction-of-defect-initial-setting">
<h2>6. Construction of defect initial setting<a class="headerlink" href="#construction-of-defect-initial-setting" title="Permalink to this headline">¶</a></h2>
<p>We then create the initial setting file for point defects with the <code class="docutils literal notranslate"><span class="pre">initial_setting</span></code> (=<code class="docutils literal notranslate"><span class="pre">is</span></code>) sub-command.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="o">~/</span><span class="n">my_bin</span><span class="o">/</span><span class="n">pydefect</span><span class="o">/</span><span class="n">pydefect</span><span class="o">/</span><span class="n">main</span><span class="o">.</span><span class="n">py</span> <span class="ow">is</span>
</pre></div>
</div>
<p>With this command, we can build the <code class="docutils literal notranslate"><span class="pre">defect.in</span></code> file, which contains the full information on what kind of defects are to be generated automatically.
At the same time, <code class="docutils literal notranslate"><span class="pre">DPOSCAR</span></code>, POSCAR used for the defect calculations, is created.
If one follows this tutorial, <code class="docutils literal notranslate"><span class="pre">DPOSCAR</span></code> should be the same as <code class="docutils literal notranslate"><span class="pre">SPOSCAR</span></code>, while if one prepares their own supercell <code class="docutils literal notranslate"><span class="pre">POSCAR</span></code>, an order of elements may be changed.</p>
<p>An example of <code class="docutils literal notranslate"><span class="pre">defect.in</span></code> looks as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>  <span class="n">Space</span> <span class="n">group</span><span class="p">:</span> <span class="n">Pm</span><span class="o">-</span><span class="mi">3</span><span class="n">m</span>

<span class="n">Transformation</span> <span class="n">matrix</span><span class="p">:</span>  <span class="mi">3</span>  <span class="mi">3</span>  <span class="mi">3</span>
<span class="n">Cell</span> <span class="n">multiplicity</span><span class="p">:</span> <span class="mi">27</span>

   <span class="n">Irreducible</span> <span class="n">element</span><span class="p">:</span> <span class="n">Ba1</span>
        <span class="n">Wyckoff</span> <span class="n">letter</span><span class="p">:</span> <span class="n">a</span>
         <span class="n">Site</span> <span class="n">symmetry</span><span class="p">:</span> <span class="n">m</span><span class="o">-</span><span class="mi">3</span><span class="n">m</span>
          <span class="n">Coordination</span><span class="p">:</span> <span class="n">O2</span><span class="o">-</span><span class="p">:</span> <span class="mf">2.9</span> <span class="mf">2.9</span> <span class="mf">2.9</span> <span class="mf">2.9</span> <span class="mf">2.9</span> <span class="mf">2.9</span> <span class="mf">2.9</span> <span class="mf">2.9</span> <span class="mf">2.9</span> <span class="mf">2.9</span> <span class="mf">2.9</span> <span class="mf">2.9</span> 
      <span class="n">Equivalent</span> <span class="n">atoms</span><span class="p">:</span> <span class="mf">1.</span><span class="o">.</span><span class="mi">27</span>
<span class="n">Fractional</span> <span class="n">coordinates</span><span class="p">:</span> <span class="mf">0.1666670</span>  <span class="mf">0.1666670</span>  <span class="mf">0.1666670</span>
     <span class="n">Electronegativity</span><span class="p">:</span> <span class="mf">0.89</span>
       <span class="n">Oxidation</span> <span class="n">state</span><span class="p">:</span> <span class="mi">2</span>

   <span class="n">Irreducible</span> <span class="n">element</span><span class="p">:</span> <span class="n">Sn1</span>
        <span class="n">Wyckoff</span> <span class="n">letter</span><span class="p">:</span> <span class="n">b</span>
         <span class="n">Site</span> <span class="n">symmetry</span><span class="p">:</span> <span class="n">m</span><span class="o">-</span><span class="mi">3</span><span class="n">m</span>
          <span class="n">Coordination</span><span class="p">:</span> <span class="n">O2</span><span class="o">-</span><span class="p">:</span> <span class="mf">2.05</span> <span class="mf">2.05</span> <span class="mf">2.05</span> <span class="mf">2.05</span> <span class="mf">2.05</span> <span class="mf">2.05</span> 
      <span class="n">Equivalent</span> <span class="n">atoms</span><span class="p">:</span> <span class="mf">28.</span><span class="o">.</span><span class="mi">54</span>
<span class="n">Fractional</span> <span class="n">coordinates</span><span class="p">:</span> <span class="mf">0.0000000</span>  <span class="mf">0.0000000</span>  <span class="mf">0.0000000</span>
     <span class="n">Electronegativity</span><span class="p">:</span> <span class="mf">1.96</span>
       <span class="n">Oxidation</span> <span class="n">state</span><span class="p">:</span> <span class="mi">4</span>
       
   <span class="n">Irreducible</span> <span class="n">element</span><span class="p">:</span> <span class="n">O1</span>
        <span class="n">Wyckoff</span> <span class="n">letter</span><span class="p">:</span> <span class="n">c</span>
         <span class="n">Site</span> <span class="n">symmetry</span><span class="p">:</span> <span class="mi">4</span><span class="o">/</span><span class="n">mmm</span>
          <span class="n">Coordination</span><span class="p">:</span> <span class="n">Ba2</span><span class="o">+</span><span class="p">:</span> <span class="mf">2.9</span> <span class="mf">2.9</span> <span class="mf">2.9</span> <span class="mf">2.9</span> <span class="n">Sn4</span><span class="o">+</span><span class="p">:</span> <span class="mf">2.05</span> <span class="mf">2.05</span> <span class="n">O2</span><span class="o">-</span><span class="p">:</span> <span class="mf">2.9</span> <span class="mf">2.9</span> <span class="mf">2.9</span> <span class="mf">2.9</span> <span class="mf">2.9</span> <span class="mf">2.9</span> <span class="mf">2.9</span> <span class="mf">2.9</span> 
      <span class="n">Equivalent</span> <span class="n">atoms</span><span class="p">:</span> <span class="mf">55.</span><span class="o">.</span><span class="mi">135</span>
<span class="n">Fractional</span> <span class="n">coordinates</span><span class="p">:</span> <span class="mf">0.0000000</span>  <span class="mf">0.1666670</span>  <span class="mf">0.0000000</span>
     <span class="n">Electronegativity</span><span class="p">:</span> <span class="mf">3.44</span>
       <span class="n">Oxidation</span> <span class="n">state</span><span class="p">:</span> <span class="o">-</span><span class="mi">2</span>

<span class="n">Interstitials</span><span class="p">:</span> 
<span class="n">Antisite</span> <span class="n">defects</span><span class="p">:</span> 

<span class="n">Substituted</span> <span class="n">defects</span><span class="p">:</span> 

<span class="n">Maximum</span> <span class="n">Displacement</span><span class="p">:</span> <span class="mf">0.2</span>

<span class="n">Exceptionally</span> <span class="n">included</span><span class="p">:</span> 
<span class="n">Exceptionally</span> <span class="n">excluded</span><span class="p">:</span> 

<span class="n">Cutoff</span> <span class="n">region</span> <span class="n">of</span> <span class="n">neighboring</span> <span class="n">atoms</span><span class="p">:</span> <span class="mf">3.0</span>
<span class="n">Symprec</span><span class="p">:</span> <span class="mf">0.01</span>
<span class="n">Angle</span> <span class="n">tolerance</span><span class="p">:</span> <span class="mi">5</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">Coordination</span></code> is shown when the interatom distance is less than 1.3 times the sum of the ionic radii
(if ionic radii are absent, atomic radii multiplied by 1.2 are used, instead).</p>
<p>If we want to add dopants <em>a posteriori</em>, we can type as follows.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="o">~/</span><span class="n">my_bin</span><span class="o">/</span><span class="n">pydefect</span><span class="o">/</span><span class="n">pydefect</span><span class="o">/</span><span class="n">main</span><span class="o">.</span><span class="n">py</span> <span class="ow">is</span> <span class="o">--</span><span class="n">print_dopant</span> <span class="n">Na</span>
</pre></div>
</div>
<p>This example of Na dopant prints</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>   <span class="n">Dopant</span> <span class="n">element</span><span class="p">:</span> <span class="n">Na</span>
<span class="n">Electronegativity</span><span class="p">:</span> <span class="mf">0.93</span>
  <span class="n">Oxidation</span> <span class="n">state</span><span class="p">:</span> <span class="mi">1</span>
</pre></div>
</div>
<p>By inserting this with an editor to <code class="docutils literal notranslate"><span class="pre">defect.in</span></code> and modify <code class="docutils literal notranslate"><span class="pre">Substituted</span> <span class="pre">defects</span></code> as follows</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>  <span class="n">Space</span> <span class="n">group</span><span class="p">:</span> <span class="n">Pm</span><span class="o">-</span><span class="mi">3</span><span class="n">m</span>

<span class="n">Transformation</span> <span class="n">matrix</span><span class="p">:</span>  <span class="mi">3</span>  <span class="mi">3</span>  <span class="mi">3</span>
<span class="n">Cell</span> <span class="n">multiplicity</span><span class="p">:</span> <span class="mi">27</span>

   <span class="n">Irreducible</span> <span class="n">element</span><span class="p">:</span> <span class="n">Ba1</span>
        <span class="n">Wyckoff</span> <span class="n">letter</span><span class="p">:</span> <span class="n">a</span>
         <span class="n">Site</span> <span class="n">symmetry</span><span class="p">:</span> <span class="n">m</span><span class="o">-</span><span class="mi">3</span><span class="n">m</span>
          <span class="n">Coordination</span><span class="p">:</span> <span class="n">O2</span><span class="o">-</span><span class="p">:</span> <span class="mf">2.9</span> <span class="mf">2.9</span> <span class="mf">2.9</span> <span class="mf">2.9</span> <span class="mf">2.9</span> <span class="mf">2.9</span> <span class="mf">2.9</span> <span class="mf">2.9</span> <span class="mf">2.9</span> <span class="mf">2.9</span> <span class="mf">2.9</span> <span class="mf">2.9</span> 
      <span class="n">Equivalent</span> <span class="n">atoms</span><span class="p">:</span> <span class="mf">1.</span><span class="o">.</span><span class="mi">27</span>
<span class="n">Fractional</span> <span class="n">coordinates</span><span class="p">:</span> <span class="mf">0.1666670</span>  <span class="mf">0.1666670</span>  <span class="mf">0.1666670</span>
     <span class="n">Electronegativity</span><span class="p">:</span> <span class="mf">0.89</span>
       <span class="n">Oxidation</span> <span class="n">state</span><span class="p">:</span> <span class="mi">2</span>

   <span class="n">Irreducible</span> <span class="n">element</span><span class="p">:</span> <span class="n">Sn1</span>
        <span class="n">Wyckoff</span> <span class="n">letter</span><span class="p">:</span> <span class="n">b</span>
         <span class="n">Site</span> <span class="n">symmetry</span><span class="p">:</span> <span class="n">m</span><span class="o">-</span><span class="mi">3</span><span class="n">m</span>
          <span class="n">Coordination</span><span class="p">:</span> <span class="n">O2</span><span class="o">-</span><span class="p">:</span> <span class="mf">2.05</span> <span class="mf">2.05</span> <span class="mf">2.05</span> <span class="mf">2.05</span> <span class="mf">2.05</span> <span class="mf">2.05</span> 
      <span class="n">Equivalent</span> <span class="n">atoms</span><span class="p">:</span> <span class="mf">28.</span><span class="o">.</span><span class="mi">54</span>
<span class="n">Fractional</span> <span class="n">coordinates</span><span class="p">:</span> <span class="mf">0.0000000</span>  <span class="mf">0.0000000</span>  <span class="mf">0.0000000</span>
     <span class="n">Electronegativity</span><span class="p">:</span> <span class="mf">1.96</span>
       <span class="n">Oxidation</span> <span class="n">state</span><span class="p">:</span> <span class="mi">4</span>

   <span class="n">Irreducible</span> <span class="n">element</span><span class="p">:</span> <span class="n">O1</span>
        <span class="n">Wyckoff</span> <span class="n">letter</span><span class="p">:</span> <span class="n">c</span>
         <span class="n">Site</span> <span class="n">symmetry</span><span class="p">:</span> <span class="mi">4</span><span class="o">/</span><span class="n">mmm</span>
          <span class="n">Coordination</span><span class="p">:</span> <span class="n">Ba2</span><span class="o">+</span><span class="p">:</span> <span class="mf">2.9</span> <span class="mf">2.9</span> <span class="mf">2.9</span> <span class="mf">2.9</span> <span class="n">Sn4</span><span class="o">+</span><span class="p">:</span> <span class="mf">2.05</span> <span class="mf">2.05</span> <span class="n">O2</span><span class="o">-</span><span class="p">:</span> <span class="mf">2.9</span> <span class="mf">2.9</span> <span class="mf">2.9</span> <span class="mf">2.9</span> <span class="mf">2.9</span> <span class="mf">2.9</span> <span class="mf">2.9</span> <span class="mf">2.9</span> 
      <span class="n">Equivalent</span> <span class="n">atoms</span><span class="p">:</span> <span class="mf">55.</span><span class="o">.</span><span class="mi">135</span>
<span class="n">Fractional</span> <span class="n">coordinates</span><span class="p">:</span> <span class="mf">0.0000000</span>  <span class="mf">0.1666670</span>  <span class="mf">0.0000000</span>
     <span class="n">Electronegativity</span><span class="p">:</span> <span class="mf">3.44</span>
       <span class="n">Oxidation</span> <span class="n">state</span><span class="p">:</span> <span class="o">-</span><span class="mi">2</span>

<span class="n">Interstitials</span><span class="p">:</span> 
<span class="n">Antisite</span> <span class="n">defects</span><span class="p">:</span> 

   <span class="n">Dopant</span> <span class="n">element</span><span class="p">:</span> <span class="n">Na</span>
<span class="n">Electronegativity</span><span class="p">:</span> <span class="mf">0.93</span>
  <span class="n">Oxidation</span> <span class="n">state</span><span class="p">:</span> <span class="mi">1</span>

<span class="n">Substituted</span> <span class="n">defects</span><span class="p">:</span> <span class="n">Na_Ba</span>

<span class="n">Maximum</span> <span class="n">Displacement</span><span class="p">:</span> <span class="mf">0.2</span>

<span class="n">Exceptionally</span> <span class="n">included</span><span class="p">:</span> 
<span class="n">Exceptionally</span> <span class="n">excluded</span><span class="p">:</span> 

<span class="n">Cutoff</span> <span class="n">region</span> <span class="n">of</span> <span class="n">neighboring</span> <span class="n">atoms</span><span class="p">:</span> <span class="mf">3.0</span>
<span class="n">Symprec</span><span class="p">:</span> <span class="mf">0.01</span>
<span class="n">Angle</span> <span class="n">tolerance</span><span class="p">:</span> <span class="mi">5</span>
</pre></div>
</div>
<p>There are so many tips related to <code class="docutils literal notranslate"><span class="pre">defect.in</span></code>.</p>
<ol>
<li><p>The antisites and substituted defects are determined from the difference of the electronegativity.
Although default is 1.0 <span>Å</span>, you can change it using <code class="docutils literal notranslate"><span class="pre">-e</span></code> option to e.g., 1.5.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="o">~/</span><span class="n">my_bin</span><span class="o">/</span><span class="n">pydefect</span><span class="o">/</span><span class="n">pydefect</span><span class="o">/</span><span class="n">main</span><span class="o">.</span><span class="n">py</span> <span class="ow">is</span> <span class="o">-</span><span class="n">e</span> <span class="mf">1.5</span>
</pre></div>
</div>
</li>
<li><p>The oxidation states determine the defect charge state.
For instance, the vacancies of Sn<sup>2+</sup> takes 0, -1, -2, while those of Sn<sup>4+</sup> take 0, -1, -2, -3, -4 charge states.
In case of interstitials, the interstitials of Sn<sup>2+</sup> takes the 0, +1, +2, while those of Sn<sup>4+</sup> take 0, +1, +2, +3, +4 charge states.
For the antisites and substituted defects, pydefect considers all possible combinations of vacancies and interstitials.
So, for example, Sn<sup>2+</sup>-on-S<sup>2-</sup> takes 0, +1, +2, +3, +4 charge states.
The oxidation states are determined using the <code class="docutils literal notranslate"><span class="pre">oxi_state_guesses</span></code> method of <code class="docutils literal notranslate"><span class="pre">Composition</span></code> class in <code class="docutils literal notranslate"><span class="pre">pymatgen</span></code>.</p></li>
<li><p>By default, positions of atoms neighboring a defect are perturbed such that the symmetry is lowered, but it is unwanted in some cases.
Then, <code class="docutils literal notranslate"><span class="pre">Maximum</span> <span class="pre">Displacement</span></code> is simply set to 0.</p></li>
</ol>
</div>
<div class="section" id="decision-of-interstitial-sites">
<h2>7. Decision of interstitial sites<a class="headerlink" href="#decision-of-interstitial-sites" title="Permalink to this headline">¶</a></h2>
<p>In addition to vacancies and antisites, one may want to add the interstitials.
For this purpose, we need to determine the interstitial sites.
Most people determine them by seeing the host crystal structures,
while there are a couple of procedures that recommend the interstitial sites.
However, it is not an easy task to speculate the most likely interstitial sites because they also depend on the substituted element in general.
For instance, when positively charged cations with closed shells are substituted (e.g., Mg<sup>2+</sup>, Al<sup>3+</sup>),
the largest vacant space should be most likely interstitial sites.
On the other hand, in case of a proton (H<sup>+</sup>),
it tends to locate near O<sup>2-</sup> or N<sup>3-</sup> to form the strong O-H or N-H bonding.
Furthermore, a hydride ion (H<sup>-</sup>) should prefer to locate at very much different places.
Therefore, we need to be careful when determining the interstitial sites.</p>
<p>To add the interstitial site at e.g., 0.375 0.375 0.375, we use the <code class="docutils literal notranslate"><span class="pre">interstitial</span></code> (=<code class="docutils literal notranslate"><span class="pre">i</span></code>) sub-command like</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="o">~/</span><span class="n">my_bin</span><span class="o">/</span><span class="n">pydefect</span><span class="o">/</span><span class="n">pydefect</span><span class="o">/</span><span class="n">main</span><span class="o">.</span><span class="n">py</span> <span class="n">i</span> <span class="o">-</span><span class="n">c</span> <span class="mf">0.375</span> <span class="mf">0.375</span> <span class="mf">0.375</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">interstitials.yaml</span></code> is then generated, which show information related to the interstitial sites.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">i1</span><span class="p">:</span>
  <span class="n">representative_coords</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.375</span><span class="p">,</span> <span class="mf">0.375</span><span class="p">,</span> <span class="mf">0.375</span><span class="p">]</span>
  <span class="n">wyckoff</span><span class="p">:</span> <span class="n">a</span>
  <span class="n">site_symmetry</span><span class="p">:</span> <span class="o">-</span><span class="mi">43</span><span class="n">m</span>
  <span class="n">symmetry_multiplicity</span><span class="p">:</span> <span class="mi">64</span>
  <span class="n">coordination_distances</span><span class="p">:</span>
    <span class="n">Mg</span><span class="p">:</span> <span class="p">[</span><span class="mf">1.84</span><span class="p">,</span> <span class="mf">1.84</span><span class="p">,</span> <span class="mf">1.84</span><span class="p">,</span> <span class="mf">1.84</span><span class="p">]</span>
    <span class="n">O</span><span class="p">:</span> <span class="p">[</span><span class="mf">1.84</span><span class="p">,</span> <span class="mf">1.84</span><span class="p">,</span> <span class="mf">1.84</span><span class="p">,</span> <span class="mf">1.84</span><span class="p">,</span> <span class="mf">3.52</span><span class="p">,</span> <span class="mf">3.52</span><span class="p">,</span> <span class="mf">3.52</span><span class="p">,</span> <span class="mf">3.52</span><span class="p">,</span> <span class="mf">3.52</span><span class="p">,</span> <span class="mf">3.52</span><span class="p">,</span> <span class="mf">3.52</span><span class="p">,</span> <span class="mf">3.52</span><span class="p">,</span> <span class="mf">3.52</span><span class="p">,</span>
      <span class="mf">3.52</span><span class="p">,</span> <span class="mf">3.52</span><span class="p">,</span> <span class="mf">3.52</span><span class="p">]</span>
  <span class="n">method</span><span class="p">:</span> <span class="n">manual</span>
</pre></div>
</div>
<p>If we want to add another site at e.g. 0.375 0.375 0.5, interstitials.yaml is updated as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">i1</span><span class="p">:</span>
  <span class="n">representative_coords</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.375</span><span class="p">,</span> <span class="mf">0.375</span><span class="p">,</span> <span class="mf">0.375</span><span class="p">]</span>
  <span class="n">wyckoff</span><span class="p">:</span> <span class="n">a</span>
  <span class="n">site_symmetry</span><span class="p">:</span> <span class="o">-</span><span class="mi">43</span><span class="n">m</span>
  <span class="n">symmetry_multiplicity</span><span class="p">:</span> <span class="mi">64</span>
  <span class="n">coordination_distances</span><span class="p">:</span>
    <span class="n">Mg</span><span class="p">:</span> <span class="p">[</span><span class="mf">1.84</span><span class="p">,</span> <span class="mf">1.84</span><span class="p">,</span> <span class="mf">1.84</span><span class="p">,</span> <span class="mf">1.84</span><span class="p">]</span>
    <span class="n">O</span><span class="p">:</span> <span class="p">[</span><span class="mf">1.84</span><span class="p">,</span> <span class="mf">1.84</span><span class="p">,</span> <span class="mf">1.84</span><span class="p">,</span> <span class="mf">1.84</span><span class="p">,</span> <span class="mf">3.52</span><span class="p">,</span> <span class="mf">3.52</span><span class="p">,</span> <span class="mf">3.52</span><span class="p">,</span> <span class="mf">3.52</span><span class="p">,</span> <span class="mf">3.52</span><span class="p">,</span> <span class="mf">3.52</span><span class="p">,</span> <span class="mf">3.52</span><span class="p">,</span> <span class="mf">3.52</span><span class="p">,</span> <span class="mf">3.52</span><span class="p">,</span>
      <span class="mf">3.52</span><span class="p">,</span> <span class="mf">3.52</span><span class="p">,</span> <span class="mf">3.52</span><span class="p">]</span>
  <span class="n">method</span><span class="p">:</span> <span class="n">manual</span>
<span class="n">i2</span><span class="p">:</span>
  <span class="n">representative_coords</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.375</span><span class="p">,</span> <span class="mf">0.375</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">]</span>
  <span class="n">wyckoff</span><span class="p">:</span> <span class="n">c</span>
  <span class="n">site_symmetry</span><span class="p">:</span> <span class="n">mmm</span>
  <span class="n">symmetry_multiplicity</span><span class="p">:</span> <span class="mi">192</span>
  <span class="n">coordination_distances</span><span class="p">:</span>
    <span class="n">Mg</span><span class="p">:</span> <span class="p">[</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mf">2.6</span><span class="p">,</span> <span class="mf">2.6</span><span class="p">,</span> <span class="mf">2.6</span><span class="p">,</span> <span class="mf">2.6</span><span class="p">]</span>
    <span class="n">O</span><span class="p">:</span> <span class="p">[</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mf">2.6</span><span class="p">,</span> <span class="mf">2.6</span><span class="p">,</span> <span class="mf">2.6</span><span class="p">,</span> <span class="mf">2.6</span><span class="p">,</span> <span class="mf">3.36</span><span class="p">,</span> <span class="mf">3.36</span><span class="p">,</span> <span class="mf">3.36</span><span class="p">,</span> <span class="mf">3.36</span><span class="p">]</span>
  <span class="n">method</span><span class="p">:</span> <span class="n">manual</span>
</pre></div>
</div>
<p>When we try to add the site that is very close to the constituent atoms or other interstitial sites,
you will get the error message as</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Inserted</span> <span class="n">position</span> <span class="ow">is</span> <span class="n">too</span> <span class="n">close</span> <span class="n">to</span> <span class="n">another</span> <span class="n">interstitial</span> <span class="n">site</span><span class="o">.</span>
<span class="n">The</span> <span class="n">distance</span> <span class="ow">is</span> <span class="mf">0.042</span> <span class="n">A</span><span class="o">.</span>
</pre></div>
</div>
<p>However, if we really want to add the site even in such cases, we can do it by adding <code class="docutils literal notranslate"><span class="pre">--force_add</span></code> option.</p>
<p>Once we generate the interstitial.yaml, we also need to modify the <code class="docutils literal notranslate"><span class="pre">Interstitials</span></code> in <code class="docutils literal notranslate"><span class="pre">defect.in</span></code> file</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Interstitials</span><span class="p">:</span> <span class="n">i1</span>
</pre></div>
</div>
<p>Or we can type the <code class="docutils literal notranslate"><span class="pre">is</span></code> sub-command again as follows.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="o">~/</span><span class="n">my_bin</span><span class="o">/</span><span class="n">pydefect</span><span class="o">/</span><span class="n">pydefect</span><span class="o">/</span><span class="n">main</span><span class="o">.</span><span class="n">py</span> <span class="ow">is</span> <span class="o">--</span><span class="n">interstitial_sites</span> <span class="n">i1</span> <span class="n">i2</span>
</pre></div>
</div>
</div>
<div class="section" id="creation-of-defect-calculation-directories">
<h2>8. Creation of defect calculation directories<a class="headerlink" href="#creation-of-defect-calculation-directories" title="Permalink to this headline">¶</a></h2>
<p>We next create directories for point-defect calculations by the <code class="docutils literal notranslate"><span class="pre">defect_vasp_oba_set</span></code> (=<code class="docutils literal notranslate"><span class="pre">dvos</span></code>) sub-command like</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="o">~/</span><span class="n">my_bin</span><span class="o">/</span><span class="n">pydefect</span><span class="o">/</span><span class="n">pydefect</span><span class="o">/</span><span class="n">main</span><span class="o">.</span><span class="n">py</span> <span class="n">dvos</span>
</pre></div>
</div>
<p>With this command, these directories are created.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">perfect</span><span class="p">,</span> <span class="n">Na_Ba1_</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">Na_Ba1_0</span><span class="p">,</span> <span class="n">Na_Ba1_1</span><span class="p">,</span> <span class="n">Va_Ba1_</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="n">Va_Ba1_</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">Va_Ba1_0</span><span class="p">,</span> 
<span class="n">Va_O1_0</span><span class="p">,</span> <span class="n">Va_O1_1</span><span class="p">,</span> <span class="n">Va_O1_2</span><span class="p">,</span> <span class="n">Va_Sn1_0</span><span class="p">,</span> <span class="n">Va_Sn1_</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">Va_Sn1_</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="n">Va_Sn1_</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="n">Va_Sn1_</span><span class="o">-</span><span class="mi">4</span>
</pre></div>
</div>
<p>If you want to calculate only oxygen vacancies, you can restrict the calculated defects with <code class="docutils literal notranslate"><span class="pre">-kw</span></code> option and a python regular expression,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="o">~/</span><span class="n">my_bin</span><span class="o">/</span><span class="n">pydefect</span><span class="o">/</span><span class="n">pydefect</span><span class="o">/</span><span class="n">main</span><span class="o">.</span><span class="n">py</span> <span class="n">dvos</span> <span class="o">-</span><span class="n">kw</span> <span class="s2">&quot;Va_O[0-9]?_[0-9]+&quot;</span>
</pre></div>
</div>
<p>, which create these directories.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">perfect</span><span class="o">/</span> <span class="n">Va_O1_0</span><span class="o">/</span> <span class="n">Va_O1_1</span><span class="o">/</span> <span class="n">Va_O1_2</span><span class="o">/</span>
</pre></div>
</div>
<p>If you again type the same command, the following information is shown,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">2019</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">09</span> <span class="mi">17</span><span class="p">:</span><span class="mi">22</span><span class="p">:</span><span class="mi">21</span><span class="p">,</span><span class="mi">078</span> <span class="n">WARNING</span> <span class="n">pydefect</span><span class="o">.</span><span class="n">input_maker</span><span class="o">.</span><span class="n">defect_entry_set_maker</span>    <span class="n">perfect</span> <span class="n">already</span> <span class="n">exists</span><span class="p">,</span> <span class="n">so</span> <span class="n">nothing</span> <span class="ow">is</span> <span class="n">done</span><span class="o">.</span>
<span class="mi">2019</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">09</span> <span class="mi">17</span><span class="p">:</span><span class="mi">22</span><span class="p">:</span><span class="mi">21</span><span class="p">,</span><span class="mi">399</span> <span class="n">WARNING</span> <span class="n">pydefect</span><span class="o">.</span><span class="n">input_maker</span><span class="o">.</span><span class="n">defect_entry_set_maker</span>    <span class="n">Va_O1_0</span> <span class="n">already</span> <span class="n">exists</span><span class="p">,</span> <span class="n">so</span> <span class="n">nothing</span> <span class="ow">is</span> <span class="n">done</span><span class="o">.</span>
<span class="mi">2019</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">09</span> <span class="mi">17</span><span class="p">:</span><span class="mi">22</span><span class="p">:</span><span class="mi">21</span><span class="p">,</span><span class="mi">744</span> <span class="n">WARNING</span> <span class="n">pydefect</span><span class="o">.</span><span class="n">input_maker</span><span class="o">.</span><span class="n">defect_entry_set_maker</span>    <span class="n">Va_O1_1</span> <span class="n">already</span> <span class="n">exists</span><span class="p">,</span> <span class="n">so</span> <span class="n">nothing</span> <span class="ow">is</span> <span class="n">done</span><span class="o">.</span>
<span class="mi">2019</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">09</span> <span class="mi">17</span><span class="p">:</span><span class="mi">22</span><span class="p">:</span><span class="mi">22</span><span class="p">,</span><span class="mi">085</span> <span class="n">WARNING</span> <span class="n">pydefect</span><span class="o">.</span><span class="n">input_maker</span><span class="o">.</span><span class="n">defect_entry_set_maker</span>    <span class="n">Va_O1_2</span> <span class="n">already</span> <span class="n">exists</span><span class="p">,</span> <span class="n">so</span> <span class="n">nothing</span> <span class="ow">is</span> <span class="n">done</span><span class="o">.</span>
</pre></div>
</div>
<p>and no directories are newly created.
This is a fail-safe treatment not to delete the calculated directories by mistake.
If you really overwrite the directories, you can use the <code class="docutils literal notranslate"><span class="pre">--force_overwrite</span></code> option.</p>
<p>In each directory, we can find the <code class="docutils literal notranslate"><span class="pre">defect_entry.json</span></code> file, containing information about a point defect obtained before the first-principles calculations.
To see summary of <code class="docutils literal notranslate"><span class="pre">defect_entry.json</span></code>, type</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="o">~/</span><span class="n">my_bin</span><span class="o">/</span><span class="n">pydefect</span><span class="o">/</span><span class="n">pydefect</span><span class="o">/</span><span class="n">main</span><span class="o">.</span><span class="n">py</span> <span class="n">de</span> <span class="o">--</span><span class="nb">print</span>
</pre></div>
</div>
<p>When you’d like to add some particular defects, you can use</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="o">~/</span><span class="n">my_bin</span><span class="o">/</span><span class="n">pydefect</span><span class="o">/</span><span class="n">pydefect</span><span class="o">/</span><span class="n">main</span><span class="o">.</span><span class="n">py</span> <span class="n">dvos</span> <span class="o">-</span><span class="n">d</span> <span class="n">Va_O1_</span><span class="o">-</span><span class="mi">1</span>
</pre></div>
</div>
<p>With this command, <code class="docutils literal notranslate"><span class="pre">Va_O1_-1/</span></code> is created.</p>
<p>We often want to calculate complex defects, peculiar defects such as DX centers, defects with different initial structures, and in such cases, need to construct <code class="docutils literal notranslate"><span class="pre">POSCAR</span></code>s by hand.
However, pydefect can generate <code class="docutils literal notranslate"><span class="pre">defect_entry.json</span></code> by parsing the <code class="docutils literal notranslate"><span class="pre">POSCAR</span></code> and <code class="docutils literal notranslate"><span class="pre">INCAR</span></code> files for the defect.
When <code class="docutils literal notranslate"><span class="pre">defect_entry.json</span></code> is generated, the directory name is parsed.
If one wants to calculate the same defect but with different atomic structure, we can use the <code class="docutils literal notranslate"><span class="pre">annotation</span></code>.</p>
<p>The directory is parsed as follows.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="n">AA_BB_CC_2_XX_YY_ZZ</span><span class="o">/</span> <span class="o">-&gt;</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;AA_BB_CC&#39;</span><span class="p">,</span> <span class="n">charge</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">annotation</span><span class="o">=</span><span class="s1">&#39;XX_YY_ZZ&#39;</span>
</pre></div>
</div>
<p>For example,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>             <span class="n">Va_Mg1_2</span><span class="o">/</span> <span class="o">-&gt;</span> <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Va_Mg1&quot;</span><span class="p">,</span>       <span class="n">charge</span> <span class="o">=</span>  <span class="mi">2</span><span class="p">,</span> <span class="n">annotation</span> <span class="o">=</span> <span class="kc">None</span>
      <span class="n">Va_O1_</span><span class="o">-</span><span class="mi">2</span><span class="n">_inward</span><span class="o">/</span> <span class="o">-&gt;</span> <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Va_O1&quot;</span><span class="p">,</span>        <span class="n">charge</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="n">annotation</span> <span class="o">=</span> <span class="s2">&quot;inward&quot;</span>
<span class="n">Mg_i</span><span class="o">+</span><span class="n">Va_O1</span><span class="o">*</span><span class="mi">2</span><span class="n">_2_coord1</span><span class="o">/</span> <span class="o">-&gt;</span> <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Mg_i+Va_O1*2&quot;</span><span class="p">,</span> <span class="n">charge</span> <span class="o">=</span>  <span class="mi">2</span><span class="p">,</span> <span class="n">annotation</span> <span class="o">=</span> <span class="s2">&quot;coord1&quot;</span>
</pre></div>
</div>
<p>Therefore, create the directory following this rule and make <code class="docutils literal notranslate"><span class="pre">POSCAR</span></code> as you want and type the following command to generate the other vasp input set.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="o">~/</span><span class="n">my_bin</span><span class="o">/</span><span class="n">pydefect</span><span class="o">/</span><span class="n">pydefect</span><span class="o">/</span><span class="n">main</span><span class="o">.</span><span class="n">py</span> <span class="n">vos</span> <span class="o">-</span><span class="n">t</span> <span class="n">defect</span> <span class="o">-</span><span class="n">x</span> <span class="n">pbesol</span> <span class="o">--</span><span class="n">dirs</span> <span class="o">.</span> <span class="o">--</span><span class="n">charge</span> <span class="o">-</span><span class="mi">1</span>
</pre></div>
</div>
<p>where the charge is assumed to be -1.</p>
<p>And then, type</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="o">~/</span><span class="n">my_bin</span><span class="o">/</span><span class="n">pydefect</span><span class="o">/</span><span class="n">pydefect</span><span class="o">/</span><span class="n">main</span><span class="o">.</span><span class="n">py</span> <span class="n">de</span> <span class="o">--</span><span class="n">make_defect_entry</span>
</pre></div>
</div>
<p>to generate <code class="docutils literal notranslate"><span class="pre">defect_entry.json</span></code>.</p>
<p> We also recommend the users to use &Gamma; version of vasp if the k-point sampling is only &Gamma; point for very large supercells.</p></div>
<div class="section" id="generation-of-supercell-information-related-to-point-defect-calculations">
<h2>9. Generation of supercell information related to point-defect calculations<a class="headerlink" href="#generation-of-supercell-information-related-to-point-defect-calculations" title="Permalink to this headline">¶</a></h2>
<p>After (partly) finishing the vasp calculations, we next parse the calculation results and generate the <code class="docutils literal notranslate"><span class="pre">dft_results.json</span></code>
that contains the first-principles calculation results related to the defect properties.</p>
<p>By using the <code class="docutils literal notranslate"><span class="pre">supercell_results</span></code> (=<code class="docutils literal notranslate"><span class="pre">sr</span></code>) sub-command like,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="o">~/</span><span class="n">my_bin</span><span class="o">/</span><span class="n">pydefect</span><span class="o">/</span><span class="n">pydefect</span><span class="o">/</span><span class="n">main</span><span class="o">.</span><span class="n">py</span> <span class="n">sr</span> <span class="o">--</span><span class="n">dir_all</span>
</pre></div>
</div>
<p>you can generate <code class="docutils literal notranslate"><span class="pre">dft_results.json</span></code> in all the directories.
When you want to parse some particular directories, <em>e.g.</em>, Va_O1_0, type</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="o">~/</span><span class="n">my_bin</span><span class="o">/</span><span class="n">pydefect</span><span class="o">/</span><span class="n">pydefect</span><span class="o">/</span><span class="n">main</span><span class="o">.</span><span class="n">py</span> <span class="n">sr</span> <span class="o">--</span><span class="n">dirs</span> <span class="n">Va_O1_0</span>
</pre></div>
</div>
<p>Here, the name of <code class="docutils literal notranslate"><span class="pre">perfect/</span></code> has special meaning, so users <strong>must</strong> use this name for the supercells without defects.</p>
<p>Some calculations might not be finished properly or still ongoing.
To see whether the calculations are properly finished, one can use the <code class="docutils literal notranslate"><span class="pre">diagnose</span></code> (=<code class="docutils literal notranslate"><span class="pre">d</span></code>) sub-command</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="o">~/</span><span class="n">my_bin</span><span class="o">/</span><span class="n">pydefect</span><span class="o">/</span><span class="n">pydefect</span><span class="o">/</span><span class="n">main</span><span class="o">.</span><span class="n">py</span> <span class="n">d</span>
</pre></div>
</div>
<p>which shows like</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>  <span class="n">Va_Ba1_</span><span class="o">-</span><span class="mi">1</span><span class="o">/</span>  <span class="n">convergence</span> <span class="p">:</span> <span class="n">F</span>    <span class="n">band</span> <span class="n">edge</span> <span class="p">:</span> <span class="n">UP</span>  <span class="p">:</span>    <span class="n">No</span> <span class="ow">in</span><span class="o">-</span><span class="n">gap</span> <span class="n">state</span>  <span class="n">DOWN</span>  <span class="p">:</span>       <span class="n">Acceptor</span> <span class="n">PHS</span>
  <span class="n">Va_Ba1_</span><span class="o">-</span><span class="mi">2</span><span class="o">/</span>  <span class="n">convergence</span> <span class="p">:</span> <span class="n">T</span>    <span class="n">band</span> <span class="n">edge</span> <span class="p">:</span> <span class="n">UP</span>  <span class="p">:</span>    <span class="n">No</span> <span class="ow">in</span><span class="o">-</span><span class="n">gap</span> <span class="n">state</span>  <span class="n">DOWN</span>  <span class="p">:</span>    <span class="n">No</span> <span class="ow">in</span><span class="o">-</span><span class="n">gap</span> <span class="n">state</span>
   <span class="n">Va_Ba1_0</span><span class="o">/</span>  <span class="n">No</span> <span class="n">supercell</span> <span class="n">results</span> <span class="n">file</span><span class="o">.</span>
    <span class="n">Va_O1_0</span><span class="o">/</span>  <span class="n">convergence</span> <span class="p">:</span> <span class="n">T</span>    <span class="n">band</span> <span class="n">edge</span> <span class="p">:</span> <span class="n">UP</span>  <span class="p">:</span>    <span class="n">Localized</span> <span class="n">state</span>  <span class="n">DOWN</span>  <span class="p">:</span>    <span class="n">Localized</span> <span class="n">state</span>
    <span class="n">Va_O1_1</span><span class="o">/</span>  <span class="n">convergence</span> <span class="p">:</span> <span class="n">T</span>    <span class="n">band</span> <span class="n">edge</span> <span class="p">:</span> <span class="n">UP</span>  <span class="p">:</span>    <span class="n">Localized</span> <span class="n">state</span>  <span class="n">DOWN</span>  <span class="p">:</span>    <span class="n">Localized</span> <span class="n">state</span>
    <span class="n">Va_O1_2</span><span class="o">/</span>  <span class="n">convergence</span> <span class="p">:</span> <span class="n">T</span>    <span class="n">band</span> <span class="n">edge</span> <span class="p">:</span> <span class="n">UP</span>  <span class="p">:</span>    <span class="n">Localized</span> <span class="n">state</span>  <span class="n">DOWN</span>  <span class="p">:</span>    <span class="n">Localized</span> <span class="n">state</span>
  <span class="n">Va_Sn1_</span><span class="o">-</span><span class="mi">1</span><span class="o">/</span>  <span class="n">convergence</span> <span class="p">:</span> <span class="n">T</span>    <span class="n">band</span> <span class="n">edge</span> <span class="p">:</span> <span class="n">UP</span>  <span class="p">:</span>    <span class="n">No</span> <span class="ow">in</span><span class="o">-</span><span class="n">gap</span> <span class="n">state</span>  <span class="n">DOWN</span>  <span class="p">:</span>    <span class="n">Localized</span> <span class="n">state</span>
  <span class="n">Va_Sn1_</span><span class="o">-</span><span class="mi">2</span><span class="o">/</span>  <span class="n">convergence</span> <span class="p">:</span> <span class="n">T</span>    <span class="n">band</span> <span class="n">edge</span> <span class="p">:</span> <span class="n">UP</span>  <span class="p">:</span>    <span class="n">Localized</span> <span class="n">state</span>  <span class="n">DOWN</span>  <span class="p">:</span>    <span class="n">Localized</span> <span class="n">state</span>
  <span class="n">Va_Sn1_</span><span class="o">-</span><span class="mi">3</span><span class="o">/</span>  <span class="n">convergence</span> <span class="p">:</span> <span class="n">T</span>    <span class="n">band</span> <span class="n">edge</span> <span class="p">:</span> <span class="n">UP</span>  <span class="p">:</span>    <span class="n">Localized</span> <span class="n">state</span>  <span class="n">DOWN</span>  <span class="p">:</span>    <span class="n">Localized</span> <span class="n">state</span>
  <span class="n">Va_Sn1_</span><span class="o">-</span><span class="mi">4</span><span class="o">/</span>  <span class="n">convergence</span> <span class="p">:</span> <span class="n">T</span>    <span class="n">band</span> <span class="n">edge</span> <span class="p">:</span> <span class="n">UP</span>  <span class="p">:</span>    <span class="n">Localized</span> <span class="n">state</span>  <span class="n">DOWN</span>  <span class="p">:</span>    <span class="n">Localized</span> <span class="n">state</span>
   <span class="n">Va_Sn1_0</span><span class="o">/</span>  <span class="n">convergence</span> <span class="p">:</span> <span class="n">T</span>    <span class="n">band</span> <span class="n">edge</span> <span class="p">:</span> <span class="n">UP</span>  <span class="p">:</span>    <span class="n">No</span> <span class="ow">in</span><span class="o">-</span><span class="n">gap</span> <span class="n">state</span>  <span class="n">DOWN</span>  <span class="p">:</span>    <span class="n">Localized</span> <span class="n">state</span>
</pre></div>
</div>
<p>If the convergences at the electronic and/or ionic step are not attained, convergence is shown as <code class="docutils literal notranslate"><span class="pre">F</span></code>.
Net to the convergence, we can see band edge information at the spin up (UP) and down (DOWN) channels, which will be explained later.</p>
</div>
<div class="section" id="corrections-of-defect-formation-energies-in-finite-size-supercells">
<h2>10. Corrections of defect formation energies in finite-size supercells<a class="headerlink" href="#corrections-of-defect-formation-energies-in-finite-size-supercells" title="Permalink to this headline">¶</a></h2>
<p>When supercell method is adopted, obtained total energies for <strong>charged defects</strong> are not properly estimated due to interaction between a defect, its images, and background charge.
Therefore, we need to correct total energies of charged defect supercells to predict those in dilute limit.</p>
<p>The corrections are attained using the <code class="docutils literal notranslate"><span class="pre">extended_fnv_correction</span></code> (=<code class="docutils literal notranslate"><span class="pre">efc</span></code>) sub-command,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="o">~/</span><span class="n">my_bin</span><span class="o">/</span><span class="n">pydefect</span><span class="o">/</span><span class="n">pydefect</span><span class="o">/</span><span class="n">main</span><span class="o">.</span><span class="n">py</span> <span class="n">efc</span> <span class="o">--</span><span class="n">unitcell_json</span> <span class="o">../</span><span class="n">unitcell</span><span class="o">/</span><span class="n">unitcell</span><span class="o">.</span><span class="n">json</span> <span class="o">--</span><span class="n">perfect_json</span> <span class="n">perfect</span><span class="o">/</span><span class="n">dft_results</span><span class="o">.</span><span class="n">json</span>
</pre></div>
</div>
<p>For the corrections, we need the dielectric constants and atomic site potential of perfect supercell.
Therefore, the paths to <code class="docutils literal notranslate"><span class="pre">unitcell.json</span></code> and <code class="docutils literal notranslate"><span class="pre">dft_results.json</span></code> of <code class="docutils literal notranslate"><span class="pre">perfect</span></code> must be assigned.
Bear also in mind that this command takes some time, so we recommend the users to prepare coffee or go on a walk outside during this process.</p>
<p>The correction method adopted in pydefect at this moment is the so-called extended Freysoldt-Neugebauer-Van de Walle (eFNV) method.
so if one uses the corrections, please cite the following papers.</p>
<ul class="simple">
<li><p><a class="reference external" href="https://journals.aps.org/prb/abstract/10.1103/PhysRevB.89.195205">Y. Kumagai*, and F. Oba, Electrostatics-based finite-size corrections for first-principles point defect calculations, Phys. Rev. B, 89 195205 (2014).</a></p></li>
<li><p><a class="reference external" href="https://journals.aps.org/prl/abstract/10.1103/PhysRevLett.102.016402">C. Freysoldt, J. Neugebauer, C. Van de Walle, Fully Ab Initio Finite-Size Corrections for Charged-Defect Supercell Calculations, Phys. Rev. Lett., 102 016402 (2009).</a></p></li>
</ul>
<p>You obtain potential.eps file, which contains information about defect-induced and point-charge potential,
and their differences at each atomic site as shown below.</p>
<p>The width and height of the horizontal line indicate the averaged region and ∆VPC, q/b|far, respectively.
When performing the corrections, I strongly recommend you to check all the potential.eps files of your calculated defects so as to reduce careless mistakes as much as possible.</p>
</div>
<div class="section" id="check-defect-eigenvalues">
<h2>11. Check defect eigenvalues<a class="headerlink" href="#check-defect-eigenvalues" title="Permalink to this headline">¶</a></h2>
<p>Generally, point defects are divided into three types.</p>
<p>First type is the defects with deep localized states inside the band gap.
This type of defect is considered to be detrimental for device performances as the carriers are trapped by the localized states.
Therefore, in the theoretical researches, it is important to know the position of the localized state and its origin.</p>
<p>Second type is the defects without any defect states, which should not affect the electronic properties as long as their concentrations are sufficiently low.</p>
<p>Third type is the defects with hydrogenic states, or perturbed host states (PHS), which are carriers locating at the band edges loosely trapped by the defects.
An examples are the B-on-Si (p-type) and P-on-Si (n-type) in Si.
This type of defect also do little harm for device performances, but introduce the carrier electrons.
The wavefunctions of the PHS widespread to several million atoms, so we need to calculate such supergiant supercells to estimate their thermodynamical transition levels.Instead, we thus describe that <code class="docutils literal notranslate"><span class="pre">the</span> <span class="pre">defects</span> <span class="pre">have</span> <span class="pre">PHS</span> <span class="pre">and</span> <span class="pre">their</span> <span class="pre">transition</span> <span class="pre">energies</span> <span class="pre">locate</span> <span class="pre">near</span> <span class="pre">band</span> <span class="pre">edges</span></code> only qualitatively.
See, for examples.</p>
<ul class="simple">
<li><p><a class="reference external" href="https://link.aps.org/pdf/10.1103/PhysRevB.90.125202">Y. Kumagai*, M. Choi, Y. Nose, and F. Oba, First-principles study of point defects in chalcopyrite ZnSnP2, Phys. Rev. B, 90 125202 (2014).</a></p></li>
<li><p><a class="reference external" href="https://link.aps.org/doi/10.1103/PhysRevApplied.6.014009">Y. Kumagai*, L. A. Burton, A. Walsh, and F. Oba, Electronic structure and defect physics of tin sulfides: SnS, Sn2S3, and SnS2, Phys. Rev. Applied, 6 014009 (2016).</a></p></li>
<li><p><a class="reference external" href="https://journals.aps.org/prapplied/abstract/10.1103/PhysRevApplied.8.014015">Y. Kumagai*, K. Harada, H. Akamatsu, K. Matsuzaki, and F. Oba, Carrier-Induced Band-Gap Variation and Point Defects in Zn3N2 from First Principles, Phys. Rev. Applied, 8 014015 (2017).</a></p></li>
<li><p><a class="reference external" href="https://journals.aps.org/prapplied/abstract/10.1103/PhysRevApplied.9.034019">Y. Kumagai*, N. Tsunoda, and F. Oba, Point defects and p-type doping in ScN from first principles, Phys. Rev. Applied, 9 034019 (2018).</a></p></li>
<li><p><a class="reference external" href="https://journals.aps.org/prapplied/abstract/10.1103/PhysRevApplied.10.011001">N. Tsunoda, Y. Kumagai*, A. Takahashi, and F. Oba, Electrically benign defect behavior in ZnSnN2 revealed from first principles, Phys. Rev. Applied, 10 011001 (2018).</a></p></li>
</ul>
<p>Due to such a situation, it is important to see the defect levels and judge if the carriers create the PHS or defect localized states.
pydefect show the calculated eigenvalues and the band-edge states by the <code class="docutils literal notranslate"><span class="pre">eigenvalues</span></code> (=<code class="docutils literal notranslate"><span class="pre">eig</span></code>) sub-command</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="o">~/</span><span class="n">my_bin</span><span class="o">/</span><span class="n">pydefect</span><span class="o">/</span><span class="n">pydefect</span><span class="o">/</span><span class="n">main</span><span class="o">.</span><span class="n">py</span> <span class="n">eig</span> <span class="o">--</span><span class="n">defect_dir</span> <span class="o">.</span> <span class="o">--</span><span class="n">unitcell</span> <span class="o">../../</span><span class="n">unitcell</span><span class="o">/</span><span class="n">unitcell</span><span class="o">.</span><span class="n">json</span> <span class="o">--</span><span class="n">perfect</span> <span class="o">../</span><span class="n">perfect</span><span class="o">/</span><span class="n">dft_results</span><span class="o">.</span><span class="n">json</span> <span class="o">-</span><span class="n">s</span> <span class="n">eig</span><span class="o">.</span><span class="n">png</span>
</pre></div>
</div>
<p>or using the diagnose sub-command as shown above.</p>
<p>The given <code class="docutils literal notranslate"><span class="pre">eig.png</span></code> looks like
<img alt="_images/eig1.png" src="_images/eig1.png" />V<sub>Mg</sub><sup>-2</sup>
<img alt="_images/eig2.png" src="_images/eig2.png" />V<sub>Mg</sub><sup>0</sup>
<img alt="_images/eig3.png" src="_images/eig3.png" />Mg<sub>i</sub><sup>0</sup></p>
<p>These are examples of V<sub>Mg</sub><sup>-2</sup> and V<sub>Mg</sub><sup>0</sup> in MgSe.
Here, one can see occupations of single-particle levels in the spin-up and -down channels.
The x-axis and y-axis are fractional coordinates of sampled k points and single-particle energy in the absolute scale, respectively.
Filled circles inside the figures are eigenenergies in the defect supercells.
There are also five lines, namely VBM and CBM in the unitcell (<strong>blue</strong>), those in the perfect supercell (<strong>red</strong>), and the Fermi level in the defect supercells.
The numbers in the figure indicate the band indices, which are shown discretely.</p>
<p>The filled circles are categorized into blue, green, orange ones which mean the occupied, partially occupied (from 0.1 to 0.9), unoccupied eigenstates in the defect supercell, respectively.
The</p>
<p>We emphasize that the automatically determined band-edge states could be incorrect as it is difficult to determine them.
Therefore, please carefully check the band-edge states, and draw the band-decomposed charge density states if the band-edge states are not so obvious.</p>
<p>If you find the automatically determined band-edge states are incorrect, you can modify it by</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="o">~/</span><span class="n">my_bin</span><span class="o">/</span><span class="n">pydefect</span><span class="o">/</span><span class="n">pydefect</span><span class="o">/</span><span class="n">main</span><span class="o">.</span><span class="n">py</span> <span class="n">sr</span> <span class="o">-</span><span class="n">be</span> <span class="n">up</span> <span class="n">acceptor_phs</span> <span class="o">--</span><span class="n">dirs</span> <span class="o">.</span>
</pre></div>
</div>
<p>and</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="o">~/</span><span class="n">my_bin</span><span class="o">/</span><span class="n">pydefect</span><span class="o">/</span><span class="n">pydefect</span><span class="o">/</span><span class="n">main</span><span class="o">.</span><span class="n">py</span> <span class="n">sr</span> <span class="o">-</span><span class="n">be</span> <span class="n">down</span> <span class="n">acceptor_phs</span> <span class="o">--</span><span class="n">dirs</span> <span class="o">.</span>
</pre></div>
</div>
<p>for both spin-up and -down states.
There are four supported states <code class="docutils literal notranslate"><span class="pre">donor_phs</span></code>, <code class="docutils literal notranslate"><span class="pre">acceptor_phs</span></code>, <code class="docutils literal notranslate"><span class="pre">localized_state</span></code>, <code class="docutils literal notranslate"><span class="pre">no_in_gap</span></code>, the former two are considered as shallow states, and omitted for energy plot by default.</p>
</div>
<div class="section" id="plot-defect-formation-energies">
<h2>12. Plot defect formation energies<a class="headerlink" href="#plot-defect-formation-energies" title="Permalink to this headline">¶</a></h2>
<p>Here, we show how to plot the defect formation energies.</p>
<p>The plot of the defect formation energies requires a wide variety of information, namely
band edges, chemical potentials of competing phases, total energy of perfect supercell.</p>
<p>Here, we plot the defect formation energies as a function of the Fermi level with the <code class="docutils literal notranslate"><span class="pre">plot_energy</span></code> (=<code class="docutils literal notranslate"><span class="pre">pe</span></code>) sub-command</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="o">~/</span><span class="n">my_bin</span><span class="o">/</span><span class="n">pydefect</span><span class="o">/</span><span class="n">pydefect</span><span class="o">/</span><span class="n">main</span><span class="o">.</span><span class="n">py</span> <span class="n">pe</span> <span class="o">--</span><span class="n">unitcell</span> <span class="o">../</span><span class="n">unitcell</span><span class="o">/</span><span class="n">unitcell</span><span class="o">.</span><span class="n">json</span> <span class="o">--</span><span class="n">perfect</span> <span class="n">perfect</span><span class="o">/</span><span class="n">dft_results</span><span class="o">.</span><span class="n">json</span> <span class="o">--</span><span class="n">defect_dirs</span> <span class="n">Va</span><span class="o">*</span><span class="n">_</span><span class="o">*</span> <span class="o">--</span><span class="n">chem_pot_yaml</span> <span class="o">../</span><span class="n">competing_phases</span><span class="o">/</span><span class="n">vertices_</span><span class="o">*.</span><span class="n">yaml</span> <span class="o">-</span><span class="n">x</span> <span class="o">-</span><span class="mi">1</span> <span class="mi">8</span> <span class="o">-</span><span class="n">s</span> <span class="n">energy_A</span><span class="o">.</span><span class="n">pdf</span>
</pre></div>
</div>
<p>which shows like,
<img alt="_images/energy.png" src="_images/energy.png" /></p>
<p>This command
Once the calculation directories are parsed, <code class="docutils literal notranslate"><span class="pre">defect_energies.json</span></code> is automatically generated.
If one wants to regenerate the results, one needs to remove it.</p>
<p>If one wants to change the condition for chemical potential, namely the position of vertex in
the chemical potential diagram, use <code class="docutils literal notranslate"><span class="pre">--chem_pot_label</span></code> option.</p>
<p>There are many options for this sub-command.
For instance, if one wants to restrict the plot only for the nitrogen vacancies, one
can use <code class="docutils literal notranslate"><span class="pre">--filtering</span></code> option like,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="o">~/</span><span class="n">my_bin</span><span class="o">/</span><span class="n">pydefect</span><span class="o">/</span><span class="n">pydefect</span><span class="o">/</span><span class="n">main</span><span class="o">.</span><span class="n">py</span> <span class="n">pe</span> <span class="o">--</span><span class="n">unitcell</span> <span class="o">../</span><span class="n">unitcell</span><span class="o">/</span><span class="n">unitcell</span><span class="o">.</span><span class="n">json</span> <span class="o">--</span><span class="n">perfect</span> <span class="n">perfect</span><span class="o">/</span><span class="n">dft_results</span><span class="o">.</span><span class="n">json</span> <span class="o">--</span><span class="n">defect_dirs</span> <span class="n">Va</span><span class="o">*</span><span class="n">_</span><span class="o">*</span> <span class="o">--</span><span class="n">chem_pot_yaml</span> <span class="o">../</span><span class="n">competing_phases</span><span class="o">/</span><span class="n">vertices_</span><span class="o">*.</span><span class="n">yaml</span> <span class="o">-</span><span class="n">x</span> <span class="o">-</span><span class="mi">1</span> <span class="mi">8</span> <span class="o">-</span><span class="n">s</span> <span class="n">energy_A</span><span class="o">.</span><span class="n">pdf</span>
</pre></div>
</div>
</div>
<div class="section" id="show-local-structure-information">
<h2>13. Show local structure information<a class="headerlink" href="#show-local-structure-information" title="Permalink to this headline">¶</a></h2>
<p>We also regularly check local structures around defects.
<code class="docutils literal notranslate"><span class="pre">pydefect</span></code> can show the local structure information by text using the following command.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="o">~/</span><span class="n">my_bin</span><span class="o">/</span><span class="n">pydefect</span><span class="o">/</span><span class="n">pydefect</span><span class="o">/</span><span class="n">main</span><span class="o">.</span><span class="n">py</span> <span class="n">ls</span>
</pre></div>
</div>
<p>which shows an example of V<sub>Se</sub><sup>-2</sup> in MgSe, e.g.,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">element</span> <span class="n">initial</span>   <span class="n">final</span>   <span class="n">disp</span>  <span class="n">angle</span>            
 <span class="n">name</span>   <span class="n">dist</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>  <span class="n">dist</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>  <span class="n">dist</span>  <span class="p">(</span><span class="n">deg</span><span class="p">)</span>   <span class="n">direction</span>
    <span class="n">Mg</span>    <span class="mf">2.57</span>     <span class="mf">3.72</span>   <span class="mf">1.15</span>   <span class="mi">180</span>      <span class="n">outward</span>
    <span class="n">Mg</span>    <span class="mf">2.56</span>     <span class="mf">3.20</span>   <span class="mf">0.64</span>   <span class="mi">174</span>      <span class="n">outward</span>
    <span class="n">Mg</span>    <span class="mf">2.56</span>     <span class="mf">3.20</span>   <span class="mf">0.64</span>   <span class="mi">174</span>      <span class="n">outward</span>
    <span class="n">Mg</span>    <span class="mf">2.56</span>     <span class="mf">3.20</span>   <span class="mf">0.64</span>   <span class="mi">175</span>      <span class="n">outward</span>
</pre></div>
</div>
<p>where the defect position is assumed to locate at the original Se atomic site.</p>
</div>
<div class="section" id="calculate-the-carrier-and-defect-concentrations">
<h2>14. Calculate the carrier and defect concentrations<a class="headerlink" href="#calculate-the-carrier-and-defect-concentrations" title="Permalink to this headline">¶</a></h2>
<p>We can also calculate the carrier and defect concentrations using the defect formation energies using <code class="docutils literal notranslate"><span class="pre">pydefect</span></code>.
For the calculations, <code class="docutils literal notranslate"><span class="pre">unitcell.json</span></code> and <code class="docutils literal notranslate"><span class="pre">defect_energies.json</span></code> are needed.
When one wants to calculate the equilibrium carrier and defect concentrations at 1000K, use the <code class="docutils literal notranslate"><span class="pre">concentrations</span></code> (=<code class="docutils literal notranslate"><span class="pre">c</span></code>) sub-command as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="n">python</span> <span class="o">~/</span><span class="n">my_bin</span><span class="o">/</span><span class="n">pydefect</span><span class="o">/</span><span class="n">pydefect</span><span class="o">/</span><span class="n">main</span><span class="o">.</span><span class="n">py</span> <span class="n">c</span> <span class="o">--</span><span class="n">unitcell</span> <span class="o">../</span><span class="n">unitcell</span><span class="o">/</span><span class="n">unitcell</span><span class="o">.</span><span class="n">json</span> <span class="o">-</span><span class="n">t</span> <span class="mi">1000</span>
</pre></div>
</div>
<p>which shows</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">++</span> <span class="n">Equilibrium</span> <span class="n">concentration</span>
<span class="n">Temperature</span><span class="p">:</span> <span class="mf">1000.0</span> <span class="n">K</span><span class="o">.</span>
<span class="n">Fermi</span> <span class="n">level</span> <span class="kn">from</span> <span class="nn">vbm</span><span class="p">:</span> <span class="mf">1.98</span> <span class="n">eV</span><span class="o">.</span>
            <span class="n">p</span><span class="p">:</span> <span class="mf">9.3e+10</span> <span class="n">cm</span><span class="o">-</span><span class="mf">3.</span>
            <span class="n">n</span><span class="p">:</span> <span class="mf">2.0e+16</span> <span class="n">cm</span><span class="o">-</span><span class="mf">3.</span>
        <span class="n">p</span> <span class="o">-</span> <span class="n">n</span><span class="p">:</span> <span class="o">-</span><span class="mf">2.0e+16</span> <span class="n">cm</span><span class="o">-</span><span class="mf">3.</span>
<span class="o">---</span>
      <span class="n">Mg_i1_2</span><span class="p">:</span> <span class="mf">1.0e+16</span> <span class="n">cm</span><span class="o">-</span><span class="mf">3.</span>
<span class="o">---</span>
     <span class="n">Se_i1_</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span> <span class="mf">1.4e+02</span> <span class="n">cm</span><span class="o">-</span><span class="mf">3.</span>
<span class="o">---</span>
    <span class="n">Va_Mg1_</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span> <span class="mf">3.7e+04</span> <span class="n">cm</span><span class="o">-</span><span class="mf">3.</span>
    <span class="n">Va_Mg1_</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span> <span class="mf">8.9e+07</span> <span class="n">cm</span><span class="o">-</span><span class="mf">3.</span>
     <span class="n">Va_Mg1_0</span><span class="p">:</span> <span class="mf">2.4e-03</span> <span class="n">cm</span><span class="o">-</span><span class="mf">3.</span>
<span class="o">---</span>
     <span class="n">Va_Se1_0</span><span class="p">:</span> <span class="mf">3.4e+16</span> <span class="n">cm</span><span class="o">-</span><span class="mf">3.</span>
     <span class="n">Va_Se1_1</span><span class="p">:</span> <span class="mf">2.8e+12</span> <span class="n">cm</span><span class="o">-</span><span class="mf">3.</span>
     <span class="n">Va_Se1_2</span><span class="p">:</span> <span class="mf">1.8e+10</span> <span class="n">cm</span><span class="o">-</span><span class="mf">3.</span>

<span class="o">++</span> <span class="n">Quenched</span> <span class="n">equilibrium</span> <span class="n">concentration</span>
<span class="n">Temperature</span><span class="p">:</span> <span class="mi">298</span> <span class="n">K</span><span class="o">.</span>
<span class="n">Fermi</span> <span class="n">level</span> <span class="kn">from</span> <span class="nn">vbm</span><span class="p">:</span> <span class="mf">2.38</span> <span class="n">eV</span><span class="o">.</span>
            <span class="n">p</span><span class="p">:</span> <span class="mf">0.0e+00</span> <span class="n">cm</span><span class="o">-</span><span class="mf">3.</span>
            <span class="n">n</span><span class="p">:</span> <span class="mf">2.0e+16</span> <span class="n">cm</span><span class="o">-</span><span class="mf">3.</span>
        <span class="n">p</span> <span class="o">-</span> <span class="n">n</span><span class="p">:</span> <span class="o">-</span><span class="mf">2.0e+16</span> <span class="n">cm</span><span class="o">-</span><span class="mf">3.</span>
<span class="o">---</span>
      <span class="n">Mg_i1_2</span><span class="p">:</span> <span class="mf">1.0e+16</span> <span class="n">cm</span><span class="o">-</span><span class="mf">3.</span>
<span class="o">---</span>
     <span class="n">Se_i1_</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span> <span class="mf">1.4e+02</span> <span class="n">cm</span><span class="o">-</span><span class="mf">3.</span>
<span class="o">---</span>
    <span class="n">Va_Mg1_</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span> <span class="mf">1.2e-11</span> <span class="n">cm</span><span class="o">-</span><span class="mf">3.</span>
    <span class="n">Va_Mg1_</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span> <span class="mf">8.9e+07</span> <span class="n">cm</span><span class="o">-</span><span class="mf">3.</span>
     <span class="n">Va_Mg1_0</span><span class="p">:</span> <span class="mf">5.9e-43</span> <span class="n">cm</span><span class="o">-</span><span class="mf">3.</span>
<span class="o">---</span>
     <span class="n">Va_Se1_0</span><span class="p">:</span> <span class="mf">3.4e+16</span> <span class="n">cm</span><span class="o">-</span><span class="mf">3.</span>
     <span class="n">Va_Se1_1</span><span class="p">:</span> <span class="mf">2.0e-05</span> <span class="n">cm</span><span class="o">-</span><span class="mf">3.</span>
     <span class="n">Va_Se1_2</span><span class="p">:</span> <span class="mf">6.9e-19</span> <span class="n">cm</span><span class="o">-</span><span class="mf">3.</span>
</pre></div>
</div>
<p>Since these concentrations are calculated in a selfconsistent (SC) manner, the calculations sometimes do not converge.
In such case, we can check the selfconsistent iterations using the <code class="docutils literal notranslate"><span class="pre">verbose</span></code> (=<code class="docutils literal notranslate"><span class="pre">v</span></code>) option.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Tutorial of pydefect</a><ul>
<li><a class="reference internal" href="#relaxation-of-unit-cell">1. Relaxation of unit cell</a></li>
<li><a class="reference internal" href="#calculation-of-band-dos-and-dielectric-tensor">2. Calculation of band, DOS, and dielectric tensor</a></li>
<li><a class="reference internal" href="#gathering-unitcell-information-related-to-point-defect-calculations">3. Gathering unitcell information related to point-defect calculations</a></li>
<li><a class="reference internal" href="#calculation-of-competing-phases">4. Calculation of competing phases</a></li>
<li><a class="reference internal" href="#selection-of-a-supercell">5. Selection of a supercell</a></li>
<li><a class="reference internal" href="#construction-of-defect-initial-setting">6. Construction of defect initial setting</a></li>
<li><a class="reference internal" href="#decision-of-interstitial-sites">7. Decision of interstitial sites</a></li>
<li><a class="reference internal" href="#creation-of-defect-calculation-directories">8. Creation of defect calculation directories</a></li>
<li><a class="reference internal" href="#generation-of-supercell-information-related-to-point-defect-calculations">9. Generation of supercell information related to point-defect calculations</a></li>
<li><a class="reference internal" href="#corrections-of-defect-formation-energies-in-finite-size-supercells">10. Corrections of defect formation energies in finite-size supercells</a></li>
<li><a class="reference internal" href="#check-defect-eigenvalues">11. Check defect eigenvalues</a></li>
<li><a class="reference internal" href="#plot-defect-formation-energies">12. Plot defect formation energies</a></li>
<li><a class="reference internal" href="#show-local-structure-information">13. Show local structure information</a></li>
<li><a class="reference internal" href="#calculate-the-carrier-and-defect-concentrations">14. Calculate the carrier and defect concentrations</a></li>
</ul>
</li>
</ul>

  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/tutorial.md.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="nav-item nav-item-0"><a href="index.html">pydefect beta documentation</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2019, Yu Kumagai.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 2.1.2.
    </div>
  </body>
</html>